
os: osx
osx_image: xcode9.2

sudo: false

language: node_js
node_js: "9"
environment:
  - ELECTRON_CACHE=$HOME/.cache/electron
  - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

cache:
  directories:
  - electron/node_modules
  - $HOME/.cache/electron
  - $HOME/.cache/electron-builder
  - $HOME/.npm/_prebuilds

environment:
  - access_token:
        secure:  pJmtCY7+qzctn9m6UejaJGlls3IMl8p2Tb3DjypHL+8DLmNNHK0jQZmZbb4sIJgM
before_install:
  - |
    if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      mkdir -p /tmp/git-lfs && curl -L https://github.com/github/git-lfs/releases/download/v2.3.1/git-lfs-$([ "$TRAVIS_OS_NAME" == "linux" ] && echo "linux" || echo "darwin")-amd64-2.3.1.tar.gz | tar -xz -C /tmp/git-lfs --strip-components 1
      export PATH="/tmp/git-lfs:$PATH"
    fi
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s --
  - export PATH="$HOME/.yarn/bin:$PATH"

install:
  - yarn

before_script:
  - git lfs pull

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cd electron && yarn ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd electron && yarn && electron-builder -p never; fi
  - bash cibuild.sh

before_deploy:
  - echo $DARTVER
  - echo $GCOMMIT
deploy:
  provider: releases
  api_key:
    secure: y0Xvq8GEOFeFTrSYQbX1tUQmX39zR9QGJFPskFt+WJf+wjOxAefiw2+K+Cn54kNtOS3fZd2qWvM4J9MtEBC5wccqI2wJEAOfMlBLr1ZJyt+4p/6lT0WzUvzFZMlvrI1MwUczBo21JHzA1Vuwy3pgZbCHDv283niY8sA0+IxMs39Zplf5gQJazYSSbq0cnqzLRXKFR2tBxXgDk0+zDt+FnnmEk181ez/BLJrStrZT1O5yF++q2ZxOX9UyAtJolylg4D12n8oCnIzRDO5ACQlRvompxg8561rGzYbSxdeDjM/kELi3qiyjm6pn8Kw7bSvOrHR3IXa4gqynIq2PVXfxC1jLp9Ss9puLieo2OdF2UDiVOSDq40PqIMOl+Yx0L8uqDtU/5ujAPrel6XoY1dJrxrhlrQdG4KdbgvQm/WaCvMWNTbFoWJ9hIMtETU6eou/A3bWeWb/2KGgBCyFxjWFeMGwcRFEEhrBGjcvMPz8yh/WhkAOIpjUczjuawEs/bNleg01YVZI8l5PgwfwlGC7Aa6Pc3IKXs6o4Xle8ZXbuja/VzODiNiGqC3+lHGTsWcjK0nkahXfewTQyOMLZztbVprc1eVYZnBk1mE4pcRt7LhBO5+r/IGmVuxhyQ+SlchDBo1AqeHftm8Mz8g5XlZzIYEVffxblweYyLuiEFtj/fks=
  on:
    branch:
      - master
      - 156094170-automate-build-release
  file_glob: true
  file:
    - electron/dist/*.dmg
  skip_cleanup: true
  overwrite: true

notifications:
  slack:
    secure: IWHP3fVK8/YJ9xmMQyz6zj0PnxI2pEkRgpZJUpSORHjGZFG5sGcmhb5DV2jtjY4YxQzQud7F7ZuFBzY+7yaTCnJC+tNAFzcmpgZBcxPiTfWIsWcbft1ITJtV/u+k25MVKW4YpZNpG51UInuncYLLpEZlflix322C97MtsgrZUpmWnmBEVemQ89UwaQ/SZpk6FXWPMzoGlaxr/ZF6JdsYuFHxm1/WurrpEuIRxj0TorQHqmsdgZPTK7Gg864RCKkE+55kFxTNRssZ0SmD7mWzEvHgosy+X/E8lch59qt5YFxT2tFNSzggGFATrY2VyVVl234pnlU1p2weDOdmhY8YB8PXFLkxipGmwNwaTQupzyHHj74WT9dL+1bNkbgAM+208gPa5VxaPKOgV59Z/PnuLpPIRZ8EFPJ5r/um84WjIlbQkrUkubUdlUbCc+e6bSBn5LaOJsDhonwumRk2XoKcCZLO92zZmIvlO84i/PiUvqRIG6SaLEIj081jVDYhm0o2WlnKTSKWxbCGq70L/3LSTtAjFBYELtLiYI0euYlgxskn89OtEHsPzIvVPQyfNvIie8WZ/rYKn+psoiPSVy89v8g2UZRejj0/z0jJf/MQ33s5+Z1TV3wE3QuYA6yNlViMRTUlvRLuaPwlq3A0meS7JZSsMIDjkbp9J9YlzGqw7Is=
    on_success: always
  email:
    on_failure: never
    on_succes: never
