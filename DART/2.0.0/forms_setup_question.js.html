

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      forms/setup_question.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      DART (Digital Asset Routing Tool)
    </h3>

    
      <h3>
        Resources
      </h3>
      
    

    <h3>Classes</h3><ul><li id="BaseController-nav"><a href="BaseController.html">BaseController</a><ul class='methods'><li data-type="method" id="BaseController-containerContent-nav"><a href="BaseController.html#containerContent">containerContent</a></li><li data-type="method" id="BaseController-destroy-nav"><a href="BaseController.html#destroy">destroy</a></li><li data-type="method" id="BaseController-edit-nav"><a href="BaseController.html#edit">edit</a></li><li data-type="method" id="BaseController-list-nav"><a href="BaseController.html#list">list</a></li><li data-type="method" id="BaseController-modalContent-nav"><a href="BaseController.html#modalContent">modalContent</a></li><li data-type="method" id="BaseController-new-nav"><a href="BaseController.html#new">new</a></li><li data-type="method" id="BaseController-noContent-nav"><a href="BaseController.html#noContent">noContent</a></li><li data-type="method" id="BaseController-openExternal-nav"><a href="BaseController.html#openExternal">openExternal</a></li><li data-type="method" id="BaseController-paramsToHash-nav"><a href="BaseController.html#paramsToHash">paramsToHash</a></li><li data-type="method" id="BaseController-postRenderCallback-nav"><a href="BaseController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="BaseController-redirect-nav"><a href="BaseController.html#redirect">redirect</a></li><li data-type="method" id="BaseController-update-nav"><a href="BaseController.html#update">update</a></li></ul></li><li id="Choice-nav"><a href="Choice.html">Choice</a><ul class='methods'><li data-type="method" id="Choice-makeList-nav"><a href="Choice.html#.makeList">makeList</a></li></ul></li><li id="DartProcessController-nav"><a href="DartProcessController.html">DartProcessController</a><ul class='methods'><li data-type="method" id="DartProcessController-list-nav"><a href="DartProcessController.html#list">list</a></li></ul></li><li id="DashboardController-nav"><a href="DashboardController.html">DashboardController</a><ul class='methods'><li data-type="method" id="DashboardController-_getJobOutcomeAndTimestamp-nav"><a href="DashboardController.html#_getJobOutcomeAndTimestamp">_getJobOutcomeAndTimestamp</a></li><li data-type="method" id="DashboardController-_getRecentJobSummaries-nav"><a href="DashboardController.html#_getRecentJobSummaries">_getRecentJobSummaries</a></li><li data-type="method" id="DashboardController-_getRepoReportDescriptions-nav"><a href="DashboardController.html#_getRepoReportDescriptions">_getRepoReportDescriptions</a></li><li data-type="method" id="DashboardController-_getRepoRows-nav"><a href="DashboardController.html#_getRepoRows">_getRepoRows</a></li><li data-type="method" id="DashboardController-_getViableRepoClients-nav"><a href="DashboardController.html#_getViableRepoClients">_getViableRepoClients</a></li><li data-type="method" id="DashboardController-show-nav"><a href="DashboardController.html#show">show</a></li></ul></li><li id="Form-nav"><a href="Form.html">Form</a><ul class='methods'><li data-type="method" id="Form-_initField-nav"><a href="Form.html#_initField">_initField</a></li><li data-type="method" id="Form-_initFields-nav"><a href="Form.html#_initFields">_initFields</a></li><li data-type="method" id="Form-castNewValueToType-nav"><a href="Form.html#castNewValueToType">castNewValueToType</a></li><li data-type="method" id="Form-hasErrors-nav"><a href="Form.html#hasErrors">hasErrors</a></li><li data-type="method" id="Form-parseFromDOM-nav"><a href="Form.html#parseFromDOM">parseFromDOM</a></li><li data-type="method" id="Form-setErrors-nav"><a href="Form.html#setErrors">setErrors</a></li></ul></li><li id="JobController-nav"><a href="JobController.html">JobController</a><ul class='methods'><li data-type="method" id="JobController-colorCodeJobs-nav"><a href="JobController.html#colorCodeJobs">colorCodeJobs</a></li><li data-type="method" id="JobController-list-nav"><a href="JobController.html#list">list</a></li><li data-type="method" id="JobController-new-nav"><a href="JobController.html#new">new</a></li></ul></li><li id="JobFilesController-nav"><a href="JobFilesController.html">JobFilesController</a><ul class='methods'><li data-type="method" id="JobFilesController-addFileToPackageSources-nav"><a href="JobFilesController.html#addFileToPackageSources">addFileToPackageSources</a></li><li data-type="method" id="JobFilesController-addItemsToUI-nav"><a href="JobFilesController.html#addItemsToUI">addItemsToUI</a></li><li data-type="method" id="JobFilesController-addItemToUI-nav"><a href="JobFilesController.html#addItemToUI">addItemToUI</a></li><li data-type="method" id="JobFilesController-addRow-nav"><a href="JobFilesController.html#addRow">addRow</a></li><li data-type="method" id="JobFilesController-attachDeleteEvents-nav"><a href="JobFilesController.html#attachDeleteEvents">attachDeleteEvents</a></li><li data-type="method" id="JobFilesController-attachDragAndDropEvents-nav"><a href="JobFilesController.html#attachDragAndDropEvents">attachDragAndDropEvents</a></li><li data-type="method" id="JobFilesController-findContainingItem-nav"><a href="JobFilesController.html#findContainingItem">findContainingItem</a></li><li data-type="method" id="JobFilesController-getTableRow-nav"><a href="JobFilesController.html#getTableRow">getTableRow</a></li><li data-type="method" id="JobFilesController-postRenderCallback-nav"><a href="JobFilesController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobFilesController-removeItemFromUI-nav"><a href="JobFilesController.html#removeItemFromUI">removeItemFromUI</a></li><li data-type="method" id="JobFilesController-show-nav"><a href="JobFilesController.html#show">show</a></li><li data-type="method" id="JobFilesController-updateTotal-nav"><a href="JobFilesController.html#updateTotal">updateTotal</a></li><li data-type="method" id="JobFilesController-updateTotals-nav"><a href="JobFilesController.html#updateTotals">updateTotals</a></li></ul></li><li id="JobMetadataController-nav"><a href="JobMetadataController.html">JobMetadataController</a><ul class='methods'><li data-type="method" id="JobMetadataController-_attachTagFileAutocomplete-nav"><a href="JobMetadataController.html#_attachTagFileAutocomplete">_attachTagFileAutocomplete</a></li><li data-type="method" id="JobMetadataController-_attachToggleHiddenTags-nav"><a href="JobMetadataController.html#_attachToggleHiddenTags">_attachToggleHiddenTags</a></li><li data-type="method" id="JobMetadataController-_parseMetadataForm-nav"><a href="JobMetadataController.html#_parseMetadataForm">_parseMetadataForm</a></li><li data-type="method" id="JobMetadataController-_validateMetadataForm-nav"><a href="JobMetadataController.html#_validateMetadataForm">_validateMetadataForm</a></li><li data-type="method" id="JobMetadataController-back-nav"><a href="JobMetadataController.html#back">back</a></li><li data-type="method" id="JobMetadataController-newTag-nav"><a href="JobMetadataController.html#newTag">newTag</a></li><li data-type="method" id="JobMetadataController-next-nav"><a href="JobMetadataController.html#next">next</a></li><li data-type="method" id="JobMetadataController-postRenderCallback-nav"><a href="JobMetadataController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobMetadataController-saveNewTag-nav"><a href="JobMetadataController.html#saveNewTag">saveNewTag</a></li><li data-type="method" id="JobMetadataController-show-nav"><a href="JobMetadataController.html#show">show</a></li></ul></li><li id="JobPackageOp-nav"><a href="JobPackageOp.html">JobPackageOp</a></li><li id="JobPackageOpForm-nav"><a href="JobPackageOpForm.html">JobPackageOpForm</a></li><li id="JobPackagingController-nav"><a href="JobPackagingController.html">JobPackagingController</a><ul class='methods'><li data-type="method" id="JobPackagingController-_parseJobPackagingForm-nav"><a href="JobPackagingController.html#_parseJobPackagingForm">_parseJobPackagingForm</a></li><li data-type="method" id="JobPackagingController-_renderPackagingForm-nav"><a href="JobPackagingController.html#_renderPackagingForm">_renderPackagingForm</a></li><li data-type="method" id="JobPackagingController-_updatePackaging-nav"><a href="JobPackagingController.html#_updatePackaging">_updatePackaging</a></li><li data-type="method" id="JobPackagingController-back-nav"><a href="JobPackagingController.html#back">back</a></li><li data-type="method" id="JobPackagingController-next-nav"><a href="JobPackagingController.html#next">next</a></li><li data-type="method" id="JobPackagingController-onFormatChange-nav"><a href="JobPackagingController.html#onFormatChange">onFormatChange</a></li><li data-type="method" id="JobPackagingController-onPackageNameKeyUp-nav"><a href="JobPackagingController.html#onPackageNameKeyUp">onPackageNameKeyUp</a></li><li data-type="method" id="JobPackagingController-postRenderCallback-nav"><a href="JobPackagingController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobPackagingController-show-nav"><a href="JobPackagingController.html#show">show</a></li></ul></li><li id="JobRunController-nav"><a href="JobRunController.html">JobRunController</a><ul class='methods'><li data-type="method" id="JobRunController-back-nav"><a href="JobRunController.html#back">back</a></li><li data-type="method" id="JobRunController-run-nav"><a href="JobRunController.html#run">run</a></li><li data-type="method" id="JobRunController-show-nav"><a href="JobRunController.html#show">show</a></li></ul></li><li id="JobTagsForm-nav"><a href="JobTagsForm.html">JobTagsForm</a><ul class='methods'><li data-type="method" id="JobTagsForm-_tagDefToField-nav"><a href="JobTagsForm.html#_tagDefToField">_tagDefToField</a></li></ul></li><li id="JobUploadController-nav"><a href="JobUploadController.html">JobUploadController</a><ul class='methods'><li data-type="method" id="JobUploadController-back-nav"><a href="JobUploadController.html#back">back</a></li><li data-type="method" id="JobUploadController-next-nav"><a href="JobUploadController.html#next">next</a></li><li data-type="method" id="JobUploadController-show-nav"><a href="JobUploadController.html#show">show</a></li></ul></li><li id="JobUploadForm-nav"><a href="JobUploadForm.html">JobUploadForm</a></li><li id="RunningJobsController-nav"><a href="RunningJobsController.html">RunningJobsController</a></li><li id="SetupController-nav"><a href="SetupController.html">SetupController</a><ul class='methods'><li data-type="method" id="SetupController-_formatLastRunDate-nav"><a href="SetupController.html#_formatLastRunDate">_formatLastRunDate</a></li><li data-type="method" id="SetupController-_getLastRunDate-nav"><a href="SetupController.html#_getLastRunDate">_getLastRunDate</a></li><li data-type="method" id="SetupController-end-nav"><a href="SetupController.html#end">end</a></li><li data-type="method" id="SetupController-getLogoPath-nav"><a href="SetupController.html#getLogoPath">getLogoPath</a></li><li data-type="method" id="SetupController-list-nav"><a href="SetupController.html#list">list</a></li><li data-type="method" id="SetupController-postRenderCallback-nav"><a href="SetupController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="SetupController-question-nav"><a href="SetupController.html#question">question</a></li><li data-type="method" id="SetupController-runPreQuestionCallbacks-nav"><a href="SetupController.html#runPreQuestionCallbacks">runPreQuestionCallbacks</a></li><li data-type="method" id="SetupController-start-nav"><a href="SetupController.html#start">start</a></li><li data-type="method" id="SetupController-startQuestions-nav"><a href="SetupController.html#startQuestions">startQuestions</a></li></ul></li><li id="SetupQuestion-nav"><a href="SetupQuestion.html">SetupQuestion</a><ul class='methods'><li data-type="method" id="SetupQuestion-getIntRangeValidator-nav"><a href="SetupQuestion.html#.getIntRangeValidator">getIntRangeValidator</a></li><li data-type="method" id="SetupQuestion-getPatternValidator-nav"><a href="SetupQuestion.html#.getPatternValidator">getPatternValidator</a></li><li data-type="method" id="SetupQuestion-getRequiredValidator-nav"><a href="SetupQuestion.html#.getRequiredValidator">getRequiredValidator</a></li><li data-type="method" id="SetupQuestion-_setValidationRegExp-nav"><a href="SetupQuestion.html#_setValidationRegExp">_setValidationRegExp</a></li><li data-type="method" id="SetupQuestion-getValidators-nav"><a href="SetupQuestion.html#getValidators">getValidators</a></li><li data-type="method" id="SetupQuestion-looksLikeNumericValidation-nav"><a href="SetupQuestion.html#looksLikeNumericValidation">looksLikeNumericValidation</a></li><li data-type="method" id="SetupQuestion-processResponse-nav"><a href="SetupQuestion.html#processResponse">processResponse</a></li><li data-type="method" id="SetupQuestion-readUserInput-nav"><a href="SetupQuestion.html#readUserInput">readUserInput</a></li><li data-type="method" id="SetupQuestion-saveValue-nav"><a href="SetupQuestion.html#saveValue">saveValue</a></li><li data-type="method" id="SetupQuestion-setInitialValue-nav"><a href="SetupQuestion.html#setInitialValue">setInitialValue</a></li><li data-type="method" id="SetupQuestion-validate-nav"><a href="SetupQuestion.html#validate">validate</a></li></ul></li><li id="TagFileForm-nav"><a href="TagFileForm.html">TagFileForm</a></li><li id="WorkflowForm-nav"><a href="WorkflowForm.html">WorkflowForm</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#tagsByFileAndName">tagsByFileAndName</a></li><li><a href="global.html#UIConstants">UIConstants</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        forms/setup_question.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>const $ = require('jquery');
const { AppSetting } = require('../../core/app_setting');
const { BagItProfile } = require('../../bagit/bagit_profile');
const { Choice } = require('../../ui/forms/choice');
const { Constants } = require('../../core/constants');
const { Context } = require('../../core/context');
const { Field } = require('./field');
const { InternalSetting } = require('../../core/internal_setting');
const os = require('os');
const { RemoteRepository } = require('../../core/remote_repository');
const { StorageService } = require('../../core/storage_service');
const { Util } = require('../../core/util');


/**
 * SetupQuestion is a question to be asked by a setup module. DART presents
 * these questions one at a time, and the user must provide a valid answer
 * before proceeding to the next question.
 *
 * You'll typically want to copy the responses from these questions into
 * some persistent DART setting.
 *
 * @param {object} opts - An object containing setup options.
 *
 * @param {string} id - A unique identifier for this question. This will
 * become the ID of the questions HTML form input and the
 * {@link SetupBase#afterEachQuestion}  will use it to identify which
 * question was just answered. You should prepend these with "q_" to
 * prevent HTML ID conflicts.
 *
 * @param {string} opts.question - The question to ask the user.
 *
 * @param {object} opts.mapsToProperty - An object that describes where the
 * initial value for this question should come from and where it should be
 * saved. See {@link SetupQuestion#mapsToProperty}, which includes a full
 * description and examples.
 *
 * @param {string} opts.errMessage - An error message to display if the user's
 * response is invalid.
 *
 * @param {string} [opts.heading] - An optional heading to display above
 * the question.
 *
 * @param {Array&lt;string>} [opts.options] - An optional list of allowed
 * values. If specified, the user will see an HTML select list instead of
 * a text input. The select list will contain these values and an empty
 * option.
 *
 * @param {string} [opts.dataType] - The type to which the user's response
 * should be cast. Valid values are 'number' and 'boolean'. If the dataType
 * is string you don't need to include this param, as values are strings
 * by default.
 *
 * @param {string} [opts.validation] - An object describing how to validate
 * the user's response to this question. See {@link SetupQuestion#validation}
 * for more info.
 *
 */
class SetupQuestion extends Field {
    constructor(opts) {
        super(opts.id, opts.id, opts.question, opts.initialValue)
        /**
         * The heading that will appear above the question on the
         * page that displays the question to the user.
         *
         * @type {string}
         */
        this.heading = opts.heading;
        /**
         * The data type to which the user's response should be cast.
         * Can be 'string', 'number', or 'boolean'.
         *
         * @type {string}
         * @default 'string'
         */
        this.dataType = opts.dataType || 'string';
        /**
         * The error message to display if the user provides an invalid
         * response to the question.
         *
         * @type {string}
         */
        this.errMessage = opts.errMessage || Context.y18n.__("The response is not valid.");
        /**
         * An object that describes how this question should be validated.
         * The object has the following properties.
         *
         *
         * required: Set this to true if the user must respond. Default is
         * false.
         *
         * pattern: A regular expression pattern against which to validate the
         * user's response. You can set this to a quoted pattern like "/\\w+/"
         * or use one of the values defined in Constants, such as:
         *
         * - {@link Constants.RE_DOMAIN}
         * - {@link Constants.RE_EMAIL}
         * - {@link Constants.RE_FILE_PATH_POSIX}
         * - {@link Constants.RE_FILE_PATH_WINDOWS}
         * - {@link Constants.RE_FILE_PATH_ANY_OS}
         * - {@link Constants.RE_IPV4}
         *
         * min: If the response should be numeric, this specifies that it must
         * be greater than or equal to this value.
         *
         * max: If the response should be numeric, this specifies that it must
         * be less than or equal to this value.
         *
         * @example
         *
         * // Create a validator that requires an answer and will accept
         * // any answer (no min, max, or pattern).
         * opts.validator = {
         *     required: true
         * }
         *
         * // Validator that does not require a response, but if given, the
         * // response must be an email address. Note that RE_EMAIL comes
         * // from the Constants module.
         * opts.validator = {
         *     pattern: 'RE_EMAIL'
         * }
         *
         * // Validator that requires a string of 4 or more hex digits.
         * // The string pattern will be converted to a RegExp.
         * opts.validator = {
         *     required: true,
         *     pattern: '[a-fA-F0-9]{4,}'
         * }
         *
         * // Validator requiring a number between 1 and 100 inclusive.
         * opts.validator = {
         *     required: true,
         *     min: 1,
         *     max: 100
         * }
         *
         *
         * @type {object}
         */
        this.validation = opts.validation;
        /**
         * An object that defines what setting value or BagItProfile tag
         * value the question maps to. When the question appears, it will
         * take its initial value from the specified setting/property, or
         * from the specified BagItProfile tag value. When the user provides
         * a valid response, the value of that response will be assigned to
         * the setting/property or tag value.
         *
         * @example
         *
         * // Map this question to the value property of an AppSetting
         * opts.mapsToProperty = {
         *    type: 'AppSetting',
         *    id: 'e8a7556f-ba6b-413f-9e8a-1682a5134ebb',
         *    property: 'value'
         * }
         *
         * // Map this question to the password property of a StorageService
         * opts.mapsToProperty = {
         *    type: 'StorageService',
         *    id: 'c329c0e9-8d0c-4a8b-b7e7-45ff084a90c1',
         *    property: 'password'
         * }
         *
         * // Map this property to the Source-Organization tag in the
         * // bag-info.txt file of a BagItProfile
         * opts.mapsToProperty = {
         *    type: 'BagItProfile',
         *    id: '271b9309-2c85-4821-aeb2-7ae209c7aaa8',
         *    tagFile: 'bag-info.txt',
         *    tagName: 'Source-Organization'
         * }
         *
         * @type {object}
         */
        this.mapsToProperty = opts.mapsToProperty;
        /**
         * An optional list of allowed values to choose from. These will
         * be converted into a list of Choice objects in the base
         * {@link Field} class.
         *
         * @type {Array&lt;string>}
         */
        this.options;

        if (Array.isArray(opts.options)) {
            this.options = opts.options;
        }
    }

    /**
     * Given a list list of strings, this builds the list of
     * {@Link Choice} objects that will appear as options in the
     * HTML select list.
     *
     * @para {Array&lt;string>} options
     */
    set options(options) {
        this.setInitialValue();
        this.choices = Choice.makeList(options, this.value, true);
    }

    /**
     * This returns the value that the user entered in the form input
     * field. The returned value will be cast to
     * @{link SetupQuestion#dataType}.
     *
     * @returns {string|number|boolean}
     */
    readUserInput() {
        let field = this;
        let formValue = $(`#${field.id}`).val() || '';
        return Util.cast(formValue.trim(), this.dataType);
    }

    /**
     * This reads the value the user input on the form. If the input
     * is valid, assigns the value of the input to the property or
     * profile tag to which this question is mapped.
     *
     * @returns {boolean}
     */
    processResponse() {
        this.value = this.readUserInput();
        Context.logger.debug("Got value: " + this.value);
        if (this.validate()) {
            Context.logger.debug("Value is valid");
            this.saveValue();
            return true;
        }
        return false;
    }

    /**
     * This sets the initial value in the HTML text input or select list.
     * The value of the setting comes from the value of the property of an
     * AppSetting, InternalSetting, RemoteRepository, StorageService, or
     * BagItProfile, as specified in  {@link SetupQuestion#mapsToProperty}
     *
     */
    setInitialValue() {
        let obj = this._getMappedObject();
        if (this.mapsToProperty.tagFile &amp;&amp; this.mapsToProperty.tagName) {
            let tags = obj.getTagsFromFile(this.mapsToProperty.tagFile, this.mapsToProperty.tagName);
            if (!tags || tags.length == 0) {
                throw new Error(Context.y18n.__('BagIt Profile has no tags where tag file = %s and tag name = %s', this.mapsToProperty.tagFile, this.mapsToProperty.tagName));
            }
            this.value = tags[0].getValue();
        } else {
            this.value = obj[this.mapsToProperty.property];
        }
    }

    /**
     * This returns an object of type AppSetting, InternalSetting,
     * RemoteRepository, StorageService, or
     * BagItProfile, as specified in  {@link SetupQuestion#mapsToProperty}
     *
     * @private
     */
    _getMappedObject() {
        let obj;
        Context.logger.debug(`Looking for ${this.mapsToProperty.type} with id ${this.mapsToProperty.id}`);
        switch(this.mapsToProperty.type) {
        case 'AppSetting':
            obj = AppSetting.find(this.mapsToProperty.id);
            break;
        case 'BagItProfile':
            obj = BagItProfile.find(this.mapsToProperty.id);
            break;
        case 'InternalSetting':
            obj = AppSetting.find(this.mapsToProperty.id);
            break;
        case 'RemoteRepository':
            obj = RemoteRepository.find(this.mapsToProperty.id);
            break;
        case 'StorageService':
            obj = StorageService.find(this.mapsToProperty.id);
            break;
        default:
            throw new Error(Context.y18n.__("Unknown type: %s"), this.mapsToProperty.type);
        }
        if(!obj) {
            throw new Error(Context.y18n.__('Could not find object of type %s with id %s', this.mapsToProperty.type, this.mapsToProperty.id));
        }
        return obj;
    }

    /**
     * This saves the value the user entered into the HTML text input or
     * select list. The value is saved to the property of an
     * AppSetting, InternalSetting, RemoteRepository, StorageService, or
     * BagItProfile, as specified in {@link SetupQuestion#mapsToProperty}
     *
     */
    saveValue() {
        let obj = this._getMappedObject();
        Context.logger.info(`Saving ${this.value} to ${obj}`);
        if (this.mapsToProperty.tagFile &amp;&amp; this.mapsToProperty.tagName) {
            let tags = obj.getTagsFromFile(this.mapsToProperty.tagFile, this.mapsToProperty.tagName);
            tags[0].userValue = this.value;
        } else {
            obj[this.mapsToProperty.property] = this.value;
        }
        obj.save();
    }


    /**
     * Returns true if this question's current {@link SetupQuestion#value} is
     * valid, false if not.
     *
     * @returns {boolean}
     */
    validate() {
        let validators = this.getValidators();
        for (let isValid of validators) {
            if (!isValid(this.value)) {
                return false;
            }
        }
        return true;
    }


    /**
     * This returns a list of validation functions based on the requirements
     * specified in this.validators. Each of the functions in the returned
     * array takes a single param, value, and returns true or false to indicate
     * whether the value is valid.
     *
     * @returns {Array&lt;function>}
     */
    getValidators() {
        let validators = [];
        this._ensureMinMax();
        this._setValidationRegExp();
        if (this.validation) {
            if (this.validation.required) {
                validators.push(SetupQuestion.getRequiredValidator());
            }
            if (this.looksLikeNumericValidation()) {
                validators.push(SetupQuestion.getIntRangeValidator(
                    this.validation.min,
                    this.validation.max,
                    !this.validation.required))
            }
            if (this.validation.regexp) {
                validators.push(SetupQuestion.getPatternValidator(
                    this.validation.regexp,
                    !this.validation.required))
            }
        }
        return validators;
    }

    /**
     * This sets the RegExp object for validation if the validation object
     * includes a pattern property. If validation.pattern is set to any of
     * the following strings, this assigns the RegExp from the Constants
     * module: 'RE_DOMAIN', 'RE_IPV4', 'RE_FILE_PATH_POSIX',
     * 'RE_FILE_PATH_WINDOWS', 'RE_FILE_PATH_ANY_OS', 'RE_EMAIL'.
     *
     * If validation.pattern is set to any other string, this converts the
     * string to a regexp.
     *
     * The resulting RegExp is assigned to this.validation.regexp.
     *
     * @pattern
     */
    _setValidationRegExp() {
        if (this.validation &amp;&amp; this.validation.pattern) {
            if (this.validation.pattern.startsWith('RE_')) {
                this.validation.regexp = Constants[this.validation.pattern];
            } else {
                this.validation.regexp = new RegExp(this.validation.pattern);
            }
        }
    }

    /**
     * If this question's validation requirements include either a min
     * or a max value, this ensures that it includes BOTH a min and max
     * value, so we can use the {@link SetupQuestion.getIntRangeValidator}
     * to validate the response.
     *
     * If this question does not have validation requirements, or the
     * validation requirements include neither min nor max, this method
     * does nothing.
     *
     * @private
     */
    _ensureMinMax() {
        if (this.looksLikeNumericValidation()) {
            if (typeof this.validation.min != 'number') {
                this.validation.min = Number.MIN_SAFE_INTEGER;
            }
            if (typeof this.validation.max != 'number') {
                this.validation.max = Number.MAX_SAFE_INTEGER;
            }
        }
    }

    /**
     * Returns true if this question has validation requirements that include
     * a min and or max value.
     *
     * @returns {boolean}
     */
    looksLikeNumericValidation() {
        return (this.validation &amp;&amp; (typeof this.validation.min == 'number' || typeof this.validation.max == 'number'))
    }


    /**
     * Returns a validator function that tests whether a value is empty.
     * The validator function returns false if it gets an empty value,
     * true otherwise.
     *
     * @returns {function}
     */
    static getRequiredValidator() {
        return function(value) {
            return !Util.isEmpty(value);
        }
    }

    /**
     * Returns a validator function that tests whether a value matches
     * a regular expression pattern. The validator function returns true
     * if the value matches the pattern false otherwise.
     *
     * The Constants module contains a number of pre-defined patterns,
     * including:
     *
     * - {@link Constants.RE_DOMAIN}
     * - {@link Constants.RE_EMAIL}
     * - {@link Constants.RE_FILE_PATH_POSIX}
     * - {@link Constants.RE_FILE_PATH_WINDOWS}
     * - {@link Constants.RE_FILE_PATH_ANY_OS}
     * - {@link Constants.RE_IPV4}
     *
     * @param {RegExp} pattern - The pattern to test against.
     *
     * @param {boolean} emptyOk - Are empty response allowed? Default is false.
     *
     * @returns {function}
     */
    static getPatternValidator(pattern, emptyOk = false) {
        return function(value) {
            return emptyOk &amp;&amp; Util.isEmpty(value) || value.match(pattern) !== null;
        }
    }

    /**
     * Returns a validator function that checks whether an interger value
     * is within a given range. The function returns true or false.
     *
     * @param {number} min - The minimum value. A valid integer must be
     * greater than or equal to this.
     *
     * @param {number} max - The maximum value. A valid integer must be
     * less than or equal to this.
     *
     * @param {boolean} emptyOk - Are empty response allowed? Default is false.
     *
     * @returns {function}
     */
    static getIntRangeValidator(min, max, emptyOk = false) {
        return function(value) {
            if (emptyOk &amp;&amp; Util.isEmpty(value)) {
                return true;
            }
            let intValue = NaN;
            if (typeof value === 'string') {
                intValue = parseInt(value, 10);
            } else if (typeof value === 'number') {
                intValue = Math.floor(value);
            }
            if (isNaN(intValue)) {
                return false
            }
            return intValue >= min &amp;&amp; intValue &lt;= max;
        }
    }
}

module.exports.SetupQuestion = SetupQuestion;
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
