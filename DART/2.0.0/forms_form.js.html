

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      forms/form.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      DART (Digital Asset Routing Tool)
    </h3>

    
      <h3>
        Resources
      </h3>
      
    

    <h3>Classes</h3><ul><li id="BaseController-nav"><a href="BaseController.html">BaseController</a><ul class='methods'><li data-type="method" id="BaseController-containerContent-nav"><a href="BaseController.html#containerContent">containerContent</a></li><li data-type="method" id="BaseController-destroy-nav"><a href="BaseController.html#destroy">destroy</a></li><li data-type="method" id="BaseController-edit-nav"><a href="BaseController.html#edit">edit</a></li><li data-type="method" id="BaseController-list-nav"><a href="BaseController.html#list">list</a></li><li data-type="method" id="BaseController-modalContent-nav"><a href="BaseController.html#modalContent">modalContent</a></li><li data-type="method" id="BaseController-new-nav"><a href="BaseController.html#new">new</a></li><li data-type="method" id="BaseController-noContent-nav"><a href="BaseController.html#noContent">noContent</a></li><li data-type="method" id="BaseController-openExternal-nav"><a href="BaseController.html#openExternal">openExternal</a></li><li data-type="method" id="BaseController-paramsToHash-nav"><a href="BaseController.html#paramsToHash">paramsToHash</a></li><li data-type="method" id="BaseController-postRenderCallback-nav"><a href="BaseController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="BaseController-redirect-nav"><a href="BaseController.html#redirect">redirect</a></li><li data-type="method" id="BaseController-update-nav"><a href="BaseController.html#update">update</a></li></ul></li><li id="Choice-nav"><a href="Choice.html">Choice</a><ul class='methods'><li data-type="method" id="Choice-makeList-nav"><a href="Choice.html#.makeList">makeList</a></li></ul></li><li id="DartProcessController-nav"><a href="DartProcessController.html">DartProcessController</a><ul class='methods'><li data-type="method" id="DartProcessController-list-nav"><a href="DartProcessController.html#list">list</a></li></ul></li><li id="DashboardController-nav"><a href="DashboardController.html">DashboardController</a><ul class='methods'><li data-type="method" id="DashboardController-_getJobOutcomeAndTimestamp-nav"><a href="DashboardController.html#_getJobOutcomeAndTimestamp">_getJobOutcomeAndTimestamp</a></li><li data-type="method" id="DashboardController-_getRecentJobSummaries-nav"><a href="DashboardController.html#_getRecentJobSummaries">_getRecentJobSummaries</a></li><li data-type="method" id="DashboardController-_getRepoReportDescriptions-nav"><a href="DashboardController.html#_getRepoReportDescriptions">_getRepoReportDescriptions</a></li><li data-type="method" id="DashboardController-_getRepoRows-nav"><a href="DashboardController.html#_getRepoRows">_getRepoRows</a></li><li data-type="method" id="DashboardController-_getViableRepoClients-nav"><a href="DashboardController.html#_getViableRepoClients">_getViableRepoClients</a></li><li data-type="method" id="DashboardController-show-nav"><a href="DashboardController.html#show">show</a></li></ul></li><li id="Form-nav"><a href="Form.html">Form</a><ul class='methods'><li data-type="method" id="Form-_initField-nav"><a href="Form.html#_initField">_initField</a></li><li data-type="method" id="Form-_initFields-nav"><a href="Form.html#_initFields">_initFields</a></li><li data-type="method" id="Form-castNewValueToType-nav"><a href="Form.html#castNewValueToType">castNewValueToType</a></li><li data-type="method" id="Form-hasErrors-nav"><a href="Form.html#hasErrors">hasErrors</a></li><li data-type="method" id="Form-parseFromDOM-nav"><a href="Form.html#parseFromDOM">parseFromDOM</a></li><li data-type="method" id="Form-setErrors-nav"><a href="Form.html#setErrors">setErrors</a></li></ul></li><li id="JobController-nav"><a href="JobController.html">JobController</a><ul class='methods'><li data-type="method" id="JobController-colorCodeJobs-nav"><a href="JobController.html#colorCodeJobs">colorCodeJobs</a></li><li data-type="method" id="JobController-list-nav"><a href="JobController.html#list">list</a></li><li data-type="method" id="JobController-new-nav"><a href="JobController.html#new">new</a></li></ul></li><li id="JobFilesController-nav"><a href="JobFilesController.html">JobFilesController</a><ul class='methods'><li data-type="method" id="JobFilesController-addFileToPackageSources-nav"><a href="JobFilesController.html#addFileToPackageSources">addFileToPackageSources</a></li><li data-type="method" id="JobFilesController-addItemsToUI-nav"><a href="JobFilesController.html#addItemsToUI">addItemsToUI</a></li><li data-type="method" id="JobFilesController-addItemToUI-nav"><a href="JobFilesController.html#addItemToUI">addItemToUI</a></li><li data-type="method" id="JobFilesController-addRow-nav"><a href="JobFilesController.html#addRow">addRow</a></li><li data-type="method" id="JobFilesController-attachDeleteEvents-nav"><a href="JobFilesController.html#attachDeleteEvents">attachDeleteEvents</a></li><li data-type="method" id="JobFilesController-attachDragAndDropEvents-nav"><a href="JobFilesController.html#attachDragAndDropEvents">attachDragAndDropEvents</a></li><li data-type="method" id="JobFilesController-findContainingItem-nav"><a href="JobFilesController.html#findContainingItem">findContainingItem</a></li><li data-type="method" id="JobFilesController-getTableRow-nav"><a href="JobFilesController.html#getTableRow">getTableRow</a></li><li data-type="method" id="JobFilesController-postRenderCallback-nav"><a href="JobFilesController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobFilesController-removeItemFromUI-nav"><a href="JobFilesController.html#removeItemFromUI">removeItemFromUI</a></li><li data-type="method" id="JobFilesController-show-nav"><a href="JobFilesController.html#show">show</a></li><li data-type="method" id="JobFilesController-updateTotal-nav"><a href="JobFilesController.html#updateTotal">updateTotal</a></li><li data-type="method" id="JobFilesController-updateTotals-nav"><a href="JobFilesController.html#updateTotals">updateTotals</a></li></ul></li><li id="JobMetadataController-nav"><a href="JobMetadataController.html">JobMetadataController</a><ul class='methods'><li data-type="method" id="JobMetadataController-_attachTagFileAutocomplete-nav"><a href="JobMetadataController.html#_attachTagFileAutocomplete">_attachTagFileAutocomplete</a></li><li data-type="method" id="JobMetadataController-_attachToggleHiddenTags-nav"><a href="JobMetadataController.html#_attachToggleHiddenTags">_attachToggleHiddenTags</a></li><li data-type="method" id="JobMetadataController-_parseMetadataForm-nav"><a href="JobMetadataController.html#_parseMetadataForm">_parseMetadataForm</a></li><li data-type="method" id="JobMetadataController-_validateMetadataForm-nav"><a href="JobMetadataController.html#_validateMetadataForm">_validateMetadataForm</a></li><li data-type="method" id="JobMetadataController-back-nav"><a href="JobMetadataController.html#back">back</a></li><li data-type="method" id="JobMetadataController-newTag-nav"><a href="JobMetadataController.html#newTag">newTag</a></li><li data-type="method" id="JobMetadataController-next-nav"><a href="JobMetadataController.html#next">next</a></li><li data-type="method" id="JobMetadataController-postRenderCallback-nav"><a href="JobMetadataController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobMetadataController-saveNewTag-nav"><a href="JobMetadataController.html#saveNewTag">saveNewTag</a></li><li data-type="method" id="JobMetadataController-show-nav"><a href="JobMetadataController.html#show">show</a></li></ul></li><li id="JobPackageOp-nav"><a href="JobPackageOp.html">JobPackageOp</a></li><li id="JobPackageOpForm-nav"><a href="JobPackageOpForm.html">JobPackageOpForm</a></li><li id="JobPackagingController-nav"><a href="JobPackagingController.html">JobPackagingController</a><ul class='methods'><li data-type="method" id="JobPackagingController-_parseJobPackagingForm-nav"><a href="JobPackagingController.html#_parseJobPackagingForm">_parseJobPackagingForm</a></li><li data-type="method" id="JobPackagingController-_renderPackagingForm-nav"><a href="JobPackagingController.html#_renderPackagingForm">_renderPackagingForm</a></li><li data-type="method" id="JobPackagingController-_updatePackaging-nav"><a href="JobPackagingController.html#_updatePackaging">_updatePackaging</a></li><li data-type="method" id="JobPackagingController-back-nav"><a href="JobPackagingController.html#back">back</a></li><li data-type="method" id="JobPackagingController-next-nav"><a href="JobPackagingController.html#next">next</a></li><li data-type="method" id="JobPackagingController-onFormatChange-nav"><a href="JobPackagingController.html#onFormatChange">onFormatChange</a></li><li data-type="method" id="JobPackagingController-onPackageNameKeyUp-nav"><a href="JobPackagingController.html#onPackageNameKeyUp">onPackageNameKeyUp</a></li><li data-type="method" id="JobPackagingController-postRenderCallback-nav"><a href="JobPackagingController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobPackagingController-show-nav"><a href="JobPackagingController.html#show">show</a></li></ul></li><li id="JobRunController-nav"><a href="JobRunController.html">JobRunController</a><ul class='methods'><li data-type="method" id="JobRunController-back-nav"><a href="JobRunController.html#back">back</a></li><li data-type="method" id="JobRunController-run-nav"><a href="JobRunController.html#run">run</a></li><li data-type="method" id="JobRunController-show-nav"><a href="JobRunController.html#show">show</a></li></ul></li><li id="JobTagsForm-nav"><a href="JobTagsForm.html">JobTagsForm</a><ul class='methods'><li data-type="method" id="JobTagsForm-_tagDefToField-nav"><a href="JobTagsForm.html#_tagDefToField">_tagDefToField</a></li></ul></li><li id="JobUploadController-nav"><a href="JobUploadController.html">JobUploadController</a><ul class='methods'><li data-type="method" id="JobUploadController-back-nav"><a href="JobUploadController.html#back">back</a></li><li data-type="method" id="JobUploadController-next-nav"><a href="JobUploadController.html#next">next</a></li><li data-type="method" id="JobUploadController-show-nav"><a href="JobUploadController.html#show">show</a></li></ul></li><li id="JobUploadForm-nav"><a href="JobUploadForm.html">JobUploadForm</a></li><li id="RunningJobsController-nav"><a href="RunningJobsController.html">RunningJobsController</a></li><li id="SetupController-nav"><a href="SetupController.html">SetupController</a><ul class='methods'><li data-type="method" id="SetupController-_formatLastRunDate-nav"><a href="SetupController.html#_formatLastRunDate">_formatLastRunDate</a></li><li data-type="method" id="SetupController-_getLastRunDate-nav"><a href="SetupController.html#_getLastRunDate">_getLastRunDate</a></li><li data-type="method" id="SetupController-end-nav"><a href="SetupController.html#end">end</a></li><li data-type="method" id="SetupController-getLogoPath-nav"><a href="SetupController.html#getLogoPath">getLogoPath</a></li><li data-type="method" id="SetupController-list-nav"><a href="SetupController.html#list">list</a></li><li data-type="method" id="SetupController-postRenderCallback-nav"><a href="SetupController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="SetupController-question-nav"><a href="SetupController.html#question">question</a></li><li data-type="method" id="SetupController-runPreQuestionCallbacks-nav"><a href="SetupController.html#runPreQuestionCallbacks">runPreQuestionCallbacks</a></li><li data-type="method" id="SetupController-start-nav"><a href="SetupController.html#start">start</a></li><li data-type="method" id="SetupController-startQuestions-nav"><a href="SetupController.html#startQuestions">startQuestions</a></li></ul></li><li id="SetupQuestion-nav"><a href="SetupQuestion.html">SetupQuestion</a><ul class='methods'><li data-type="method" id="SetupQuestion-getIntRangeValidator-nav"><a href="SetupQuestion.html#.getIntRangeValidator">getIntRangeValidator</a></li><li data-type="method" id="SetupQuestion-getPatternValidator-nav"><a href="SetupQuestion.html#.getPatternValidator">getPatternValidator</a></li><li data-type="method" id="SetupQuestion-getRequiredValidator-nav"><a href="SetupQuestion.html#.getRequiredValidator">getRequiredValidator</a></li><li data-type="method" id="SetupQuestion-_setValidationRegExp-nav"><a href="SetupQuestion.html#_setValidationRegExp">_setValidationRegExp</a></li><li data-type="method" id="SetupQuestion-getValidators-nav"><a href="SetupQuestion.html#getValidators">getValidators</a></li><li data-type="method" id="SetupQuestion-looksLikeNumericValidation-nav"><a href="SetupQuestion.html#looksLikeNumericValidation">looksLikeNumericValidation</a></li><li data-type="method" id="SetupQuestion-processResponse-nav"><a href="SetupQuestion.html#processResponse">processResponse</a></li><li data-type="method" id="SetupQuestion-readUserInput-nav"><a href="SetupQuestion.html#readUserInput">readUserInput</a></li><li data-type="method" id="SetupQuestion-saveValue-nav"><a href="SetupQuestion.html#saveValue">saveValue</a></li><li data-type="method" id="SetupQuestion-setInitialValue-nav"><a href="SetupQuestion.html#setInitialValue">setInitialValue</a></li><li data-type="method" id="SetupQuestion-validate-nav"><a href="SetupQuestion.html#validate">validate</a></li></ul></li><li id="TagFileForm-nav"><a href="TagFileForm.html">TagFileForm</a></li><li id="WorkflowForm-nav"><a href="WorkflowForm.html">WorkflowForm</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#tagsByFileAndName">tagsByFileAndName</a></li><li><a href="global.html#UIConstants">UIConstants</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        forms/form.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>const { Context } = require('../../core/context')
const { Field } = require('./field');
const { Util } = require('../../core/util');

/**
 * The Form class converts objects into a structure that can be
 * run through a template and converted into an HTML form.
 *
 */
class Form {
    /**
     * This returns a new form object that DART's templates can render
     * as an HTML form.
     *
     * @param {string} objType - The name of the class this form will
     * represent. For example, AppSetting, RemoteRepository, etc.
     * These are generally subclasses of PersistentObject.
     *
     * @param {PersistentObject|object} obj - The object from which you want
     * to create a form. This class will generate the form fields for all
     * of the attributes of obj, except those specified in the exclude param.
     * The obj param should be an instance of an object derived from
     * {@ref PersistentObject}, but you can create an empty form by passing
     * in an empty object like so:
     *
     * &lt;code>
     * var myForm = new Form('Object', {});
     * &lt;/code>.
     *
     * @param {Array&lt;string>} exclude - A list of object attributes to
     * exclude from the form. The form will not include fields for these
     * items. You don't need to include the 'id' or 'userCanDelete'
     * attributes in this list.
     * @default ['errors', 'help', 'required']
     *
     */
    constructor(objType, obj, exclude = ['errors', 'help', 'required']) {
        this.objType = objType;
        this.formId = Util.lcFirst(objType) + 'Form';
        this.obj = obj;
        if (typeof obj.errors === 'undefined') {
            obj.errors = {};
        }
        this.exclude = exclude;
        this.fields = {};
        this.inlineForms = [];
        this.changed = {};
        this._initFields();
    }

    /**
     * This creates fields for each attribute of form.obj, including
     * setting the name, id, value, label, error message and help text
     * of each item.
     *
     * The label and help text come from the locale file for each
     * specific language. To set the label, add an entry to to the
     * locale file named &lt;ClassName>_&lt;property>_label. To set the
     * help text, add an entry to the locale file named
     * &lt;ClassName>_&lt;property>_help. For example:
     *
     * &lt;code>
     * {
     *   "MyClass_surname_label": "Surname",
     *   "MyClass_surname_help": "Enter your family name.",
     * }
     * &lt;/code>
     *
     * This does not set the choices for select lists or checkbox groups.
     * You'll have to do that yourself after the form is created.
     *
     * This method does not determine which HTML control will render
     * on the form. Since that is a layout issue, you can specify that
     * in your form template.
     *
     */
    _initFields() {
        for(let [name, value] of Object.entries(this.obj)) {
            if (!this.exclude.includes(name)) {
                this._initField(name, value);
            }
        }
    }

    /**
     * This creates a single field with the given name and value and
     * adds it to the fields property of the form.
     *
     * @param {string} name - The name of the field to add.
     *
     * @value {string|number|boolean} value - The value of the field.
     */
    _initField(name, value) {
        let elementId = `${this.formId}_${name}`;
        let label = this._getLocalizedLabel(name);
        let field = new Field(elementId, name, label, value);
        field.error = this.obj.errors[name];
        this._setFieldHelpText(field);
        this._setRequired(field);
        this.fields[name] = field;
    }

    /**
     * This method returns the localized label for a form field.
     * It extracts the label from the locale file that matches the
     * user's current system settings. The locale file should have
     * an entry like the one below to specify the label.
     *
     * &lt;code>
     * {
     *   "MyClass_surname_label": "Surname",
     * }
     * &lt;/code>
     *
     * If there's no matching entry in the locale file, this returns
     * a modified version of the property name with the first letter
     * of each word capitalized. For example, fieldName "phoneNumber"
     * would return "Phone Number" if there is no matching locale entry.
     *
     * @param {string} fieldName - The name of the field. This is the
     * same as the name of the object property that the field will
     * represent.
     *
     * @returns {string}
     * @private
     */
    _getLocalizedLabel(fieldName) {
        let objType = this.obj.constructor.name;
        let labelKey = `${objType}_${fieldName}_label`;
        let labelText = Context.y18n.__(labelKey);
        if (labelText == labelKey) {
            labelText = Util.camelToTitle(fieldName);
        }
        return labelText;
    }

    /**
     * This sets the html attribute "required='true'" on the field
     * if the field is required. (That is, if it's included in the
     * PersistentObject's required attribute.)
     *
     * @param {Field} field
     * @private
     */
    _setRequired(field) {
        if (this.obj.required &amp;&amp; Array.isArray(this.obj.required) &amp;&amp; this.obj.required.includes(field.name)) {
            field.attrs['required'] = true;
        }
    }

    /**
     * This sets the help tooltip for the field, if it can be found
     * in the locale file. If Form.obj happens to be an AppSetting,
     * it reads the help directly from the AppSetting.help property.
     * Help strings in the locale file look like this:
     *
     * &lt;code>
     * {
     *   "MyClass_surname_help": "Enter your family name.",
     * }
     * &lt;/code>
     *
     * @param {Field} field
     * @private
     */
    _setFieldHelpText(field) {
        if (this.obj.constructor.name == 'AppSetting' &amp;&amp; this.obj.help) {
            field.help = this.obj.help;
        } else {
            let helpKey = `${this.obj.constructor.name}_${field.name}_help`;
            let helpText = Context.y18n.__(helpKey);
            if (helpText &amp;&amp; helpText != helpKey) {
                field.help = helpText;
            }
        }
    }

    /**
     * Returns true if the form contains errors. Check this after
     * calling {@link parseFromDOM} to see if there were any validation
     * errors.
     *
     * @returns {boolean}
     */
    hasErrors() {
        return this.obj.errors &amp;&amp; Object.keys(this.obj.errors).length > 0;
    }


    /**
     * This updates all of the values of Form.obj based on what the
     * user entered in the HTML form. Note that because there are no
     * PUT or POST operations in DART, this method reads directly from
     * the HTML form on the current page, casting number and boolean
     * values to the correct types.
     *
     * This also sets the values of the Form.changed object, which
     * shows the old and new values of each property that the user
     * changed.
     *
     * This returns nothing. Check the values of Form.obj and Form.changed
     * after calling this. The controller classes call this method when
     * users submit forms.
     */
    parseFromDOM() {
        // This is required for jest tests.
        if ($ === undefined) {
            var $ = require('jquery');
        }
        this.changed = {};
        // TODO: Parse checkbox groups. See JobUploadForm.copyFormValuesToJob()
        for (let [name, field] of Object.entries(this.fields)) {
            let oldValue = this.obj[name];
            let formValue = $(`#${field.id}`).val();
            if (typeof formValue === "undefined") {
                // Try parsing as checkbox group.
                formValue = $(`input[name='${name}']:checked`).toArray().map(cb => cb.value);
            }
            try {
                if (Array.isArray(formValue)) {
                    formValue = formValue.map(val => val.trim());
                } else {
                    formValue = formValue.trim();
                }
            } catch (ex) {
                console.error(`Error processing form field '${name}': ${ex.toString()}`);
            }
            let newValue = this.castNewValueToType(oldValue, formValue);
            if (oldValue !== newValue) {
                this.changed[name] = {
                    old: oldValue,
                    new: newValue
                };
                this.obj[name] = newValue;
            }
        }
    }

    /**
     * This casts a string value from a form to the correct type required
     * by the underlying object, including strings, numbers and booleans.
     *
     * @param {string|number|boolean} oldValue - The original value, read
     * from the property of Form.obj.
     *
     * @param {string} formValue - The value read from the HTML form, which
     * will always be a string.
     *
     * @returns {string|number|boolean} - The formValue cast to a type
     * that matches the type of oldValue.
     */
    castNewValueToType(oldValue, formValue) {
        let toType = typeof oldValue;
        return Util.cast(formValue, toType);
    }

    /**
     * This sets the errors on the form, based on errors flagged in the
     * {@ref PersistentObject} Form.obj.errors.
     */
    setErrors() {
        this.changed = {};
        this._initFields();

        // Some heavily customized forms call a custom _init
        // function after initializing fields.
        if (typeof this._init === 'function') {
            this._init();
        }
    }
}

module.exports.Form = Form;
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
