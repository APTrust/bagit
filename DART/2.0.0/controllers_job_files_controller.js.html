

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      controllers/job_files_controller.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      DART (Digital Asset Routing Tool)
    </h3>

    
      <h3>
        Resources
      </h3>
      
    

    <h3>Classes</h3><ul><li id="BaseController-nav"><a href="BaseController.html">BaseController</a><ul class='methods'><li data-type="method" id="BaseController-containerContent-nav"><a href="BaseController.html#containerContent">containerContent</a></li><li data-type="method" id="BaseController-destroy-nav"><a href="BaseController.html#destroy">destroy</a></li><li data-type="method" id="BaseController-edit-nav"><a href="BaseController.html#edit">edit</a></li><li data-type="method" id="BaseController-list-nav"><a href="BaseController.html#list">list</a></li><li data-type="method" id="BaseController-modalContent-nav"><a href="BaseController.html#modalContent">modalContent</a></li><li data-type="method" id="BaseController-new-nav"><a href="BaseController.html#new">new</a></li><li data-type="method" id="BaseController-noContent-nav"><a href="BaseController.html#noContent">noContent</a></li><li data-type="method" id="BaseController-openExternal-nav"><a href="BaseController.html#openExternal">openExternal</a></li><li data-type="method" id="BaseController-paramsToHash-nav"><a href="BaseController.html#paramsToHash">paramsToHash</a></li><li data-type="method" id="BaseController-postRenderCallback-nav"><a href="BaseController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="BaseController-redirect-nav"><a href="BaseController.html#redirect">redirect</a></li><li data-type="method" id="BaseController-update-nav"><a href="BaseController.html#update">update</a></li></ul></li><li id="Choice-nav"><a href="Choice.html">Choice</a><ul class='methods'><li data-type="method" id="Choice-makeList-nav"><a href="Choice.html#.makeList">makeList</a></li></ul></li><li id="DartProcessController-nav"><a href="DartProcessController.html">DartProcessController</a><ul class='methods'><li data-type="method" id="DartProcessController-list-nav"><a href="DartProcessController.html#list">list</a></li></ul></li><li id="DashboardController-nav"><a href="DashboardController.html">DashboardController</a><ul class='methods'><li data-type="method" id="DashboardController-_getJobOutcomeAndTimestamp-nav"><a href="DashboardController.html#_getJobOutcomeAndTimestamp">_getJobOutcomeAndTimestamp</a></li><li data-type="method" id="DashboardController-_getRecentJobSummaries-nav"><a href="DashboardController.html#_getRecentJobSummaries">_getRecentJobSummaries</a></li><li data-type="method" id="DashboardController-_getRepoReportDescriptions-nav"><a href="DashboardController.html#_getRepoReportDescriptions">_getRepoReportDescriptions</a></li><li data-type="method" id="DashboardController-_getRepoRows-nav"><a href="DashboardController.html#_getRepoRows">_getRepoRows</a></li><li data-type="method" id="DashboardController-_getViableRepoClients-nav"><a href="DashboardController.html#_getViableRepoClients">_getViableRepoClients</a></li><li data-type="method" id="DashboardController-show-nav"><a href="DashboardController.html#show">show</a></li></ul></li><li id="Form-nav"><a href="Form.html">Form</a><ul class='methods'><li data-type="method" id="Form-_initField-nav"><a href="Form.html#_initField">_initField</a></li><li data-type="method" id="Form-_initFields-nav"><a href="Form.html#_initFields">_initFields</a></li><li data-type="method" id="Form-castNewValueToType-nav"><a href="Form.html#castNewValueToType">castNewValueToType</a></li><li data-type="method" id="Form-hasErrors-nav"><a href="Form.html#hasErrors">hasErrors</a></li><li data-type="method" id="Form-parseFromDOM-nav"><a href="Form.html#parseFromDOM">parseFromDOM</a></li><li data-type="method" id="Form-setErrors-nav"><a href="Form.html#setErrors">setErrors</a></li></ul></li><li id="JobController-nav"><a href="JobController.html">JobController</a><ul class='methods'><li data-type="method" id="JobController-colorCodeJobs-nav"><a href="JobController.html#colorCodeJobs">colorCodeJobs</a></li><li data-type="method" id="JobController-list-nav"><a href="JobController.html#list">list</a></li><li data-type="method" id="JobController-new-nav"><a href="JobController.html#new">new</a></li></ul></li><li id="JobFilesController-nav"><a href="JobFilesController.html">JobFilesController</a><ul class='methods'><li data-type="method" id="JobFilesController-addFileToPackageSources-nav"><a href="JobFilesController.html#addFileToPackageSources">addFileToPackageSources</a></li><li data-type="method" id="JobFilesController-addItemsToUI-nav"><a href="JobFilesController.html#addItemsToUI">addItemsToUI</a></li><li data-type="method" id="JobFilesController-addItemToUI-nav"><a href="JobFilesController.html#addItemToUI">addItemToUI</a></li><li data-type="method" id="JobFilesController-addRow-nav"><a href="JobFilesController.html#addRow">addRow</a></li><li data-type="method" id="JobFilesController-attachDeleteEvents-nav"><a href="JobFilesController.html#attachDeleteEvents">attachDeleteEvents</a></li><li data-type="method" id="JobFilesController-attachDragAndDropEvents-nav"><a href="JobFilesController.html#attachDragAndDropEvents">attachDragAndDropEvents</a></li><li data-type="method" id="JobFilesController-findContainingItem-nav"><a href="JobFilesController.html#findContainingItem">findContainingItem</a></li><li data-type="method" id="JobFilesController-getTableRow-nav"><a href="JobFilesController.html#getTableRow">getTableRow</a></li><li data-type="method" id="JobFilesController-postRenderCallback-nav"><a href="JobFilesController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobFilesController-removeItemFromUI-nav"><a href="JobFilesController.html#removeItemFromUI">removeItemFromUI</a></li><li data-type="method" id="JobFilesController-show-nav"><a href="JobFilesController.html#show">show</a></li><li data-type="method" id="JobFilesController-updateTotal-nav"><a href="JobFilesController.html#updateTotal">updateTotal</a></li><li data-type="method" id="JobFilesController-updateTotals-nav"><a href="JobFilesController.html#updateTotals">updateTotals</a></li></ul></li><li id="JobMetadataController-nav"><a href="JobMetadataController.html">JobMetadataController</a><ul class='methods'><li data-type="method" id="JobMetadataController-_attachTagFileAutocomplete-nav"><a href="JobMetadataController.html#_attachTagFileAutocomplete">_attachTagFileAutocomplete</a></li><li data-type="method" id="JobMetadataController-_attachToggleHiddenTags-nav"><a href="JobMetadataController.html#_attachToggleHiddenTags">_attachToggleHiddenTags</a></li><li data-type="method" id="JobMetadataController-_parseMetadataForm-nav"><a href="JobMetadataController.html#_parseMetadataForm">_parseMetadataForm</a></li><li data-type="method" id="JobMetadataController-_validateMetadataForm-nav"><a href="JobMetadataController.html#_validateMetadataForm">_validateMetadataForm</a></li><li data-type="method" id="JobMetadataController-back-nav"><a href="JobMetadataController.html#back">back</a></li><li data-type="method" id="JobMetadataController-newTag-nav"><a href="JobMetadataController.html#newTag">newTag</a></li><li data-type="method" id="JobMetadataController-next-nav"><a href="JobMetadataController.html#next">next</a></li><li data-type="method" id="JobMetadataController-postRenderCallback-nav"><a href="JobMetadataController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobMetadataController-saveNewTag-nav"><a href="JobMetadataController.html#saveNewTag">saveNewTag</a></li><li data-type="method" id="JobMetadataController-show-nav"><a href="JobMetadataController.html#show">show</a></li></ul></li><li id="JobPackageOp-nav"><a href="JobPackageOp.html">JobPackageOp</a></li><li id="JobPackageOpForm-nav"><a href="JobPackageOpForm.html">JobPackageOpForm</a></li><li id="JobPackagingController-nav"><a href="JobPackagingController.html">JobPackagingController</a><ul class='methods'><li data-type="method" id="JobPackagingController-_parseJobPackagingForm-nav"><a href="JobPackagingController.html#_parseJobPackagingForm">_parseJobPackagingForm</a></li><li data-type="method" id="JobPackagingController-_renderPackagingForm-nav"><a href="JobPackagingController.html#_renderPackagingForm">_renderPackagingForm</a></li><li data-type="method" id="JobPackagingController-_updatePackaging-nav"><a href="JobPackagingController.html#_updatePackaging">_updatePackaging</a></li><li data-type="method" id="JobPackagingController-back-nav"><a href="JobPackagingController.html#back">back</a></li><li data-type="method" id="JobPackagingController-next-nav"><a href="JobPackagingController.html#next">next</a></li><li data-type="method" id="JobPackagingController-onFormatChange-nav"><a href="JobPackagingController.html#onFormatChange">onFormatChange</a></li><li data-type="method" id="JobPackagingController-onPackageNameKeyUp-nav"><a href="JobPackagingController.html#onPackageNameKeyUp">onPackageNameKeyUp</a></li><li data-type="method" id="JobPackagingController-postRenderCallback-nav"><a href="JobPackagingController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobPackagingController-show-nav"><a href="JobPackagingController.html#show">show</a></li></ul></li><li id="JobRunController-nav"><a href="JobRunController.html">JobRunController</a><ul class='methods'><li data-type="method" id="JobRunController-back-nav"><a href="JobRunController.html#back">back</a></li><li data-type="method" id="JobRunController-run-nav"><a href="JobRunController.html#run">run</a></li><li data-type="method" id="JobRunController-show-nav"><a href="JobRunController.html#show">show</a></li></ul></li><li id="JobTagsForm-nav"><a href="JobTagsForm.html">JobTagsForm</a><ul class='methods'><li data-type="method" id="JobTagsForm-_tagDefToField-nav"><a href="JobTagsForm.html#_tagDefToField">_tagDefToField</a></li></ul></li><li id="JobUploadController-nav"><a href="JobUploadController.html">JobUploadController</a><ul class='methods'><li data-type="method" id="JobUploadController-back-nav"><a href="JobUploadController.html#back">back</a></li><li data-type="method" id="JobUploadController-next-nav"><a href="JobUploadController.html#next">next</a></li><li data-type="method" id="JobUploadController-show-nav"><a href="JobUploadController.html#show">show</a></li></ul></li><li id="JobUploadForm-nav"><a href="JobUploadForm.html">JobUploadForm</a></li><li id="RunningJobsController-nav"><a href="RunningJobsController.html">RunningJobsController</a></li><li id="SetupController-nav"><a href="SetupController.html">SetupController</a><ul class='methods'><li data-type="method" id="SetupController-_formatLastRunDate-nav"><a href="SetupController.html#_formatLastRunDate">_formatLastRunDate</a></li><li data-type="method" id="SetupController-_getLastRunDate-nav"><a href="SetupController.html#_getLastRunDate">_getLastRunDate</a></li><li data-type="method" id="SetupController-end-nav"><a href="SetupController.html#end">end</a></li><li data-type="method" id="SetupController-getLogoPath-nav"><a href="SetupController.html#getLogoPath">getLogoPath</a></li><li data-type="method" id="SetupController-list-nav"><a href="SetupController.html#list">list</a></li><li data-type="method" id="SetupController-postRenderCallback-nav"><a href="SetupController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="SetupController-question-nav"><a href="SetupController.html#question">question</a></li><li data-type="method" id="SetupController-runPreQuestionCallbacks-nav"><a href="SetupController.html#runPreQuestionCallbacks">runPreQuestionCallbacks</a></li><li data-type="method" id="SetupController-start-nav"><a href="SetupController.html#start">start</a></li><li data-type="method" id="SetupController-startQuestions-nav"><a href="SetupController.html#startQuestions">startQuestions</a></li></ul></li><li id="SetupQuestion-nav"><a href="SetupQuestion.html">SetupQuestion</a><ul class='methods'><li data-type="method" id="SetupQuestion-getIntRangeValidator-nav"><a href="SetupQuestion.html#.getIntRangeValidator">getIntRangeValidator</a></li><li data-type="method" id="SetupQuestion-getPatternValidator-nav"><a href="SetupQuestion.html#.getPatternValidator">getPatternValidator</a></li><li data-type="method" id="SetupQuestion-getRequiredValidator-nav"><a href="SetupQuestion.html#.getRequiredValidator">getRequiredValidator</a></li><li data-type="method" id="SetupQuestion-_setValidationRegExp-nav"><a href="SetupQuestion.html#_setValidationRegExp">_setValidationRegExp</a></li><li data-type="method" id="SetupQuestion-getValidators-nav"><a href="SetupQuestion.html#getValidators">getValidators</a></li><li data-type="method" id="SetupQuestion-looksLikeNumericValidation-nav"><a href="SetupQuestion.html#looksLikeNumericValidation">looksLikeNumericValidation</a></li><li data-type="method" id="SetupQuestion-processResponse-nav"><a href="SetupQuestion.html#processResponse">processResponse</a></li><li data-type="method" id="SetupQuestion-readUserInput-nav"><a href="SetupQuestion.html#readUserInput">readUserInput</a></li><li data-type="method" id="SetupQuestion-saveValue-nav"><a href="SetupQuestion.html#saveValue">saveValue</a></li><li data-type="method" id="SetupQuestion-setInitialValue-nav"><a href="SetupQuestion.html#setInitialValue">setInitialValue</a></li><li data-type="method" id="SetupQuestion-validate-nav"><a href="SetupQuestion.html#validate">validate</a></li></ul></li><li id="TagFileForm-nav"><a href="TagFileForm.html">TagFileForm</a></li><li id="WorkflowForm-nav"><a href="WorkflowForm.html">WorkflowForm</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#tagsByFileAndName">tagsByFileAndName</a></li><li><a href="global.html#UIConstants">UIConstants</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        controllers/job_files_controller.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>const $ = require('jquery');
const { BagItProfile } = require('../../bagit/bagit_profile');
const { BaseController } = require('./base_controller');
const { Context } = require('../../core/context');
const FileSystemReader = require('../../plugins/formats/read/file_system_reader');
const fs = require('fs');
const { Job } = require('../../core/job');
const { JobTagsForm } = require('../forms/job_tags_form');
const Templates = require('../common/templates');
const { Util } = require('../../core/util');

/**
 * The JobFilesController displays the Job files page, where
 * users can drag and drop the files that a Job will package
 * and/or uploade.
 *
 * @param {URLSearchParams} params - The URL search params parsed
 * from the URL used to reach this page. This should contain at
 * least the Job Id.
 *
 * @param {string} params.id - The id of the Job being worked
 * on. Job.id is a UUID string.
 */
class JobFilesController extends BaseController {

    constructor(params) {
        super(params, 'Jobs');
        this.model = Job;
        this.nameProperty = 'title';
        this.job = Job.find(this.params.get('id'));
    }


    /**
     * This displays the Job files UI, where the user can drag
     * and drop files.
     */
    show() {
        let data = {
            alertMessage: this.alertMessage,
            job: this.job
        }
        this.alertMessage = null;
        let html = Templates.jobFiles(data);
        return this.containerContent(html);
    }


    /**
     * This attaches required events to the Job files UI and
     * adds the list of files and folders to be packaged to
     * the UI.
     */
    postRenderCallback(fnName) {
        this.attachDragAndDropEvents();
        this.attachDeleteEvents();
        this.addItemsToUI();
    }

    /**
     * This attaches drag and drop events, so users can add files
     * and folders to the job by dragging them into the application
     * window.
     */
    attachDragAndDropEvents() {
        let controller = this;
        $('#dropZone').on('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            // When drag event is attached to document, use
            // e.dataTransfer.files instead of what's below.
            for (let f of e.originalEvent.dataTransfer.files) {
                let containingItem = controller.findContainingItem(f.path);
                if (containingItem) {
                    let msg = Context.y18n.__(
                        '%s has already been added to this package as part of %s',
                        `${f.path}\n\n`,
                        `\n\n${containingItem}`
                    );
                    alert(msg);
                    continue;
                }
                controller.addFileToPackageSources(f.path);
                controller.addItemToUI(f.path);
            }
            $(e.currentTarget).removeClass('drop-zone-over');
            return false;
        });
        $('#dropZone').on('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            $(e.currentTarget).addClass('drop-zone-over');
            return false;
        });
        $('#dropZone').on('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            $(e.currentTarget).removeClass('drop-zone-over');
            return false;
        });
        $('#dropZone').on('dragend', function(e) {
            e.preventDefault();
            e.stopPropagation();
            $(e.currentTarget).removeClass('drop-zone-over');
            return false;
        });
    }

    /**
     * This attaches the deletion handler to the red X beside
     * each file and folder. Clicking the red delete icon causes
     * the filepath to be removed from the UI and from this Job's
     * list of sourceFiles in {@link PackageOperation}.
     */
    attachDeleteEvents() {
        let controller = this;
        $('#filesTable').on('click', 'td.delete-file', function(e) {
            let filepath = $(e.currentTarget).data('filepath');
            controller.removeItemFromUI(filepath);
            Util.deleteFromArray(controller.job.packageOp.sourceFiles, filepath);
            controller.job.save();
            return false;
        });
    }


    /**
     * This adds files and folders to the display.
     */
    addItemsToUI() {
        // Do not try to process any files or directories that
        // the user may have deleted.
        this.job.packageOp.pruneSourceFilesUnlessJobCompleted();
        var files = this.job.packageOp.sourceFiles.slice();
        for(var filepath of files) {
            this.addItemToUI(filepath);
        }
    }

    /**
     * This adds a single file or folder to the UI.
     */
    addItemToUI(filepath) {
        let controller = this;
        let stats = fs.statSync(filepath);
        if (stats.isFile()) {
            this.addRow(filepath, 'file', 1, 0, stats.size);
        } else if (stats.isDirectory()) {
            let fsReader = new FileSystemReader(filepath);
            fsReader.on('end', function() {
                // Add 1 to dirCount, because item itself is a directory.
                controller.addRow(filepath, 'directory', fsReader.fileCount,
                              fsReader.dirCount + 1, fsReader.byteCount);
            });
            fsReader.list();
        }
    }

    /**
     * This adds one row to the table that lists which files and
     * folders this job will package.
     *
     * @param {string} filepath - The absolute path to a file or folder
     * that is to be packaged as part of this job.
     *
     * @param {string} type - The type of item that filepath represents.
     * This should be either "file" or "directory".
     *
     * @param {number} fileCount - The number of files contained by the
     * item in param filepath. For files, this will be 1. For directories,
     * it will be the total number of files in the directory and all of
     * its subdirectories. (This info is readily available from the
     * {@link FileSystemReader} plugin.)
     *
     * @param {number} dirCount - The number of directories contained by
     * the item in param filepath. For files, this will be 0. For directories,
     * this will be 1 (for the directory itself) plus the total count of
     * all directories within that directory and all of its subdirectories.
     * (This info is readily available from the {@link FileSystemReader}
     * plugin.)
     *
     * @param {number} byteCount - The total number of bytes contained by
     * the item at filepath. For files, this will be the filesize. For
     * directories, this will be the sum of bytes contained by all the files
     * within the directory and all its subdirectories. (This info is readily
     * available from the {@link FileSystemReader} plugin.)
     *
     */
    addRow(filepath, type, fileCount, dirCount, byteCount) {
        $('#filesPanel').show();
        let row = this.getTableRow(filepath, type, fileCount, dirCount, byteCount);
        $(row).insertBefore('#fileTotals');
        this.updateTotals(fileCount, dirCount, byteCount);
    }

    /**
     * Updates the total number of files, folders, and bytes to be
     * packaged.
     *
     * @param {number} fileCount - The number of files contained by the
     * item in param filepath. For files, this will be 1. For directories,
     * it will be the total number of files in the directory and all of
     * its subdirectories. (This info is readily available from the
     * {@link FileSystemReader} plugin.) This number will be added to
     * the total file count.
     *
     * @param {number} dirCount - The number of directories contained by
     * the item in param filepath. For files, this will be 0. For directories,
     * this will be 1 (for the directory itself) plus the total count of
     * all directories within that directory and all of its subdirectories.
     * (This info is readily available from the {@link FileSystemReader}
     * plugin.) This number will be added to the total directory count.
     *
     * @param {number} byteCount - The total number of bytes contained by
     * the item at filepath. For files, this will be the filesize. For
     * directories, this will be the sum of bytes contained by all the files
     * within the directory and all its subdirectories. (This info is readily
     * available from the {@link FileSystemReader} plugin.) This number will
     * be added to the total byte count.
     *
     */
    updateTotals(fileCount, dirCount, byteCount) {
        let filesTotal = this.updateTotal('#totalFileCount', fileCount);
        let dirTotal = this.updateTotal('#totalDirCount', dirCount);
        let byteTotal = this.updateTotal('#totalByteCount', byteCount);
        this.job.fileCount = filesTotal;
        this.job.dirCount = dirTotal;
        this.job.byteCount = byteTotal;
        this.job.save();
    }

    /**
     * Updates one of the total fields at the bottom of the list of
     * files and folders, and returns the calculated total.
     *
     * @param {string} elementId - The id (css selector) of the element
     * whose text should be updated.
     *
     * @param {number} amountToAdd - The number to add to the existing
     * total already displayed in the cell. This will be negative in
     * cases where you're removing files or folders.
     *
     * @returns {number} The total value displayed in the field.
     */
    updateTotal(elementId, amountToAdd) {
        let element = $(elementId);
        let newTotal = parseInt(element.data('total'), 10) + amountToAdd;
        element.data('total', newTotal);
        if (elementId == '#totalByteCount') {
            element.text(Util.toHumanSize(newTotal));
        } else {
            element.text(newTotal);
        }
        return newTotal;
    }

    /**
     * Returns the HTML for a single table row in the files/folders
     * display.
     *
     * @param {string} filepath - The absolute path to a file or folder
     * that is to be packaged as part of this job.
     *
     * @param {string} type - The type of item that filepath represents.
     * This should be either "file" or "directory".
     *
     * @param {number} fileCount - The number of files contained by the
     * item in param filepath. For files, this will be 1. For directories,
     * it will be the total number of files in the directory and all of
     * its subdirectories. (This info is readily available from the
     * {@link FileSystemReader} plugin.)
     *
     * @param {number} dirCount - The number of directories contained by
     * the item in param filepath. For files, this will be 0. For directories,
     * this will be 1 (for the directory itself) plus the total count of
     * all directories within that directory and all of its subdirectories.
     * (This info is readily available from the {@link FileSystemReader}
     * plugin.)
     *
     * @param {number} byteCount - The total number of bytes contained by
     * the item at filepath. For files, this will be the filesize. For
     * directories, this will be the sum of bytes contained by all the files
     * within the directory and all its subdirectories. (This info is readily
     * available from the {@link FileSystemReader} plugin.)
     *
     * @returns {string} A string of HTML representing a table row.
     */
    getTableRow(filepath, type, fileCount, dirCount, byteCount) {
        let iconType = (type == 'file' ? 'file' : 'folder-closed');
        let data = {
            iconType: iconType,
            filepath: filepath,
            dirCount: dirCount,
            fileCount: fileCount,
            byteCount: byteCount,
            size: Util.toHumanSize(byteCount)
        }
        return Templates.jobFileRow(data);
    }

    /**
     * This adds a file or folder to the list of items that will be
     * packaged in this job. The item is added to the sourceFiles
     * list of the Job's {@link PackageOperation} attribute.
     *
     * @param {string} filepath - The absolute path to a file or folder
     * that is to be packaged as part of this job.
     *
     */
    addFileToPackageSources(filepath) {
        if (!Array.isArray(this.job.packageOp.sourceFiles)) {
            this.job.packageOp.sourceFiles = [];
        }
        this.job.packageOp.sourceFiles.push(filepath);
    }

    /**
     * This checks the list of source files and folders to see if
     * any of the items already set to be packaged contains the item
     * that the user just dragged into the window. We make this check
     * to avoid adding duplicate files or folders to the list of
     * sources.
     *
     * @param {string} filepath - The absolute path to a file or folder
     * that is to be packaged as part of this job.
     *
     * @return {string} - The path the already-added folder that contains
     * filepath, or null if filepath's containing folder has not already
     * been added to the list of source files.
     *
     */
    findContainingItem(filepath) {
        if (Array.isArray(this.job.packageOp.sourceFiles)) {
            for (let item of this.job.packageOp.sourceFiles) {
                if (filepath.startsWith(item)) {
                    return item;
                }
            }
        }
        return null;
    }

    /**
     * This deletes a file or folder from the list of files and folders
     * in the UI (but does not delete the item from the underlying
     * {@link PackageOperation}).
     *
     * @param {string} filepath - The absolute path to a file or folder
     * to be removed from the UI.
     *
     */
    removeItemFromUI(filepath) {
        let row = $(`tr[data-filepath="${Util.escapeBackslashes(filepath)}"]`)
        let dirCount = -1 * parseInt(row.find('td.dirCount').text(), 10);
        let fileCount = -1 * parseInt(row.find('td.fileCount').text(), 10);
        let fileSize = -1 * parseInt(row.find('td.fileSize').data('bytes'), 10);
        row.remove();
        this.updateTotals(fileCount, dirCount, fileSize)
        if ($('tr.filepath').length == 0) {
            $('#filesPanel').hide();
        }
    }

}

module.exports.JobFilesController = JobFilesController;
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
