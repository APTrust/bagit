{{ define "job-form" }}
{{ template "page_top" . }}

<h1>BagIt Profile</h1>

<form method="{{ .form.Method }}" action="{{ .form.Action }}">

  {{template "input-select" .form.Fields.Workflow }}

  {{ $relFilePath := "" }}
  {{ range $index, $field := .form.SortedTagFields }}
	{{ if $.form.SortedTagFields.RelFilePathChanged $index }}
	<fieldset><legend>{{ $field.RelativeFilePath }}</legend>
	{{ end }}
	  {{ if .Choices }}
		{{template "input-select" $field }}
	  {{ else }}
		{{template "input-text" $field }}
	  {{ end }}
	{{ if $.form.SortedTagFields.RelFilePathChanged $index }}
	</fieldset>
	{{ end }}
	{{ $relFilePath := $field.RelativeFilePath }}
  {{ end }}


	<h2>Payload Files</h2>
	<div id="payload" style="height:300px;width:500px;border:1px solid black;background-color:#efe;margin-top: 20px;"></div>
	<div id="output"></div>

  <button type="submit" name="submitButton" class="btn btn-default">Submit</button>

</form>

<script>
  const fs = require('fs');
  var stat = null;
  document.getElementById('payload').addEventListener('drop', function (e) {
	e.preventDefault();
	e.stopPropagation();
	var output = document.getElementById('output');
	for (let f of e.dataTransfer.files) {
	  stat = fs.statSync(f.path);
	  if (stat.isDirectory()) {
		 output.innerHTML += '<div><span class="glyphicon glyphicon-folder-close" aria-hidden="true">' + f.path + '</span></div>';
	  } else {
		 output.innerHTML += '<div><span class="glyphicon glyphicon-file" aria-hidden="true">' + f.path + '</span></div>';
	  }
	  // Note that for the demo, this will only save the last path
	  $('#SourceDir').val(f.path)
	}
  });
  document.getElementById('payload').addEventListener('dragover', function (e) {
	e.preventDefault();
	e.stopPropagation();
  });

  if (document.getElementById('showHideTagFields') != null) {
	document.getElementById('showHideTagFields').addEventListener('click', function (e) {
	  var inputs = document.getElementsByClassName('show-hide')
	  for (var i = 0; i < inputs.length; i++ ) {
		inputs[i].classList.toggle('hidden')
	  }
	});
  }
</script>

{{ template "page_bottom" . }}
{{ end }}
