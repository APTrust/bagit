{{ define "job-form" }}
{{ template "page_top" . }}


<h1>New Job</h1>

<form method="{{ .form.Method }}" action="{{ .form.Action }}">

<div id="div-files">
  <h2>Files</h2>
  <p>Drag files into this window.</p>
  <div id="div-files-list"></div>
</div>

<div id="div-packaging">
  <h2>Packaging</h2>

  {{template "input-select" .form.Fields.BagItProfile }}

  {{ if .form.Fields.BagName }}
  {{template "input-text" .form.Fields.BagName }}
  {{ end }}

  {{ $relFilePath := "" }}
  {{ range $index, $field := .form.SortedTagFields }}
	{{ if $.form.SortedTagFields.RelFilePathChanged $index }}
	<fieldset><legend>{{ $field.RelativeFilePath }}</legend>
	{{ end }}
	  {{ if .Choices }}
		{{template "input-select" $field }}
	  {{ else }}
		{{template "input-text" $field }}
	  {{ end }}
	{{ if $.form.SortedTagFields.RelFilePathChanged $index }}
	</fieldset>
	{{ end }}
	{{ $relFilePath := $field.RelativeFilePath }}
  {{ end }}
</div>

<div id="div-shipping">
  <h2>Shipping</h2>
  <p>Copy bag or files to the following locations.</p>
</div>

<div id="div-review">
  <h2>Review</h2>
  <p>...</p>
</div>


</form>

<script>
  const fs = require('fs');
  var stat = null;
  document.getElementById('payload').addEventListener('drop', function (e) {
	e.preventDefault();
	e.stopPropagation();
	var output = document.getElementById('output');
	for (let f of e.dataTransfer.files) {
	  stat = fs.statSync(f.path);
	  if (stat.isDirectory()) {
		 output.innerHTML += '<div><span class="glyphicon glyphicon-folder-close" aria-hidden="true">' + f.path + '</span></div>';
	  } else {
		 output.innerHTML += '<div><span class="glyphicon glyphicon-file" aria-hidden="true">' + f.path + '</span></div>';
	  }
	  // Note that for the demo, this will only save the last path
	  $('#SourceDir').val(f.path)
	}
  });
  document.getElementById('payload').addEventListener('dragover', function (e) {
	e.preventDefault();
	e.stopPropagation();
  });

  if (document.getElementById('showHideTagFields') != null) {
	document.getElementById('showHideTagFields').addEventListener('click', function (e) {
	  var inputs = document.getElementsByClassName('show-hide')
	  for (var i = 0; i < inputs.length; i++ ) {
		inputs[i].classList.toggle('hidden')
	  }
	});
  }
</script>


{{ template "page_bottom" . }}
{{ end }}
