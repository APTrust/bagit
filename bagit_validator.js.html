

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      bagit/validator.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Braintree SDK Client Reference
    </h3>

    

    <h3>Classes</h3><ul><li id="AppSetting-nav"><a href="AppSetting.html">AppSetting</a><ul class='methods'><li data-type="method" id="AppSetting-validate-nav"><a href="AppSetting.html#validate">validate</a></li></ul></li><li id="APTrustClient-nav"><a href="APTrustClient.html">APTrustClient</a><ul class='methods'><li data-type="method" id="APTrustClient-description-nav"><a href="APTrustClient.html#.description">description</a></li></ul></li><li id="APTrustSetup-nav"><a href="APTrustSetup.html">APTrustSetup</a><ul class='methods'><li data-type="method" id="APTrustSetup-description-nav"><a href="APTrustSetup.html#.description">description</a></li></ul></li><li id="Bagger-nav"><a href="Bagger.html">Bagger</a><ul class='methods'><li data-type="method" id="Bagger-_addPayloadFiles-nav"><a href="Bagger.html#_addPayloadFiles">_addPayloadFiles</a></li><li data-type="method" id="Bagger-create-nav"><a href="Bagger.html#create">create</a></li><li data-type="method" id="Bagger-validatePackagingOperation-nav"><a href="Bagger.html#validatePackagingOperation">validatePackagingOperation</a></li></ul></li><li id="BagItFile-nav"><a href="BagItFile.html">BagItFile</a><ul class='methods'><li data-type="method" id="BagItFile-getFileType-nav"><a href="BagItFile.html#.getFileType">getFileType</a></li><li data-type="method" id="BagItFile-getCryptoHash-nav"><a href="BagItFile.html#getCryptoHash">getCryptoHash</a></li><li data-type="method" id="BagItFile-getManifestEntry-nav"><a href="BagItFile.html#getManifestEntry">getManifestEntry</a></li><li data-type="method" id="BagItFile-isPayloadFile-nav"><a href="BagItFile.html#isPayloadFile">isPayloadFile</a></li><li data-type="method" id="BagItFile-isPayloadManifest-nav"><a href="BagItFile.html#isPayloadManifest">isPayloadManifest</a></li><li data-type="method" id="BagItFile-isTagFile-nav"><a href="BagItFile.html#isTagFile">isTagFile</a></li><li data-type="method" id="BagItFile-isTagManifest-nav"><a href="BagItFile.html#isTagManifest">isTagManifest</a></li></ul></li><li id="BagItProfile-nav"><a href="BagItProfile.html">BagItProfile</a><ul class='methods'><li data-type="method" id="BagItProfile-find-nav"><a href="BagItProfile.html#.find">find</a></li><li data-type="method" id="BagItProfile-fromJson-nav"><a href="BagItProfile.html#.fromJson">fromJson</a></li><li data-type="method" id="BagItProfile-inflateFrom-nav"><a href="BagItProfile.html#.inflateFrom">inflateFrom</a></li><li data-type="method" id="BagItProfile-load-nav"><a href="BagItProfile.html#.load">load</a></li><li data-type="method" id="BagItProfile-nameLooksLegal-nav"><a href="BagItProfile.html#.nameLooksLegal">nameLooksLegal</a></li><li data-type="method" id="BagItProfile-suggestGenericBagName-nav"><a href="BagItProfile.html#.suggestGenericBagName">suggestGenericBagName</a></li><li data-type="method" id="BagItProfile-bagDescription-nav"><a href="BagItProfile.html#bagDescription">bagDescription</a></li><li data-type="method" id="BagItProfile-bagInternalIdentifier-nav"><a href="BagItProfile.html#bagInternalIdentifier">bagInternalIdentifier</a></li><li data-type="method" id="BagItProfile-bagTitle-nav"><a href="BagItProfile.html#bagTitle">bagTitle</a></li><li data-type="method" id="BagItProfile-copyDefaultTagValuesFrom-nav"><a href="BagItProfile.html#copyDefaultTagValuesFrom">copyDefaultTagValuesFrom</a></li><li data-type="method" id="BagItProfile-findExactOrPartial-nav"><a href="BagItProfile.html#findExactOrPartial">findExactOrPartial</a></li><li data-type="method" id="BagItProfile-findMatchingTags-nav"><a href="BagItProfile.html#findMatchingTags">findMatchingTags</a></li><li data-type="method" id="BagItProfile-firstMatchingTag-nav"><a href="BagItProfile.html#firstMatchingTag">firstMatchingTag</a></li><li data-type="method" id="BagItProfile-getTagFileContents-nav"><a href="BagItProfile.html#getTagFileContents">getTagFileContents</a></li><li data-type="method" id="BagItProfile-getTagsFromFile-nav"><a href="BagItProfile.html#getTagsFromFile">getTagsFromFile</a></li><li data-type="method" id="BagItProfile-hasTagFile-nav"><a href="BagItProfile.html#hasTagFile">hasTagFile</a></li><li data-type="method" id="BagItProfile-isCustomTagFile-nav"><a href="BagItProfile.html#isCustomTagFile">isCustomTagFile</a></li><li data-type="method" id="BagItProfile-isValidBagName-nav"><a href="BagItProfile.html#isValidBagName">isValidBagName</a></li><li data-type="method" id="BagItProfile-mergeTagValues-nav"><a href="BagItProfile.html#mergeTagValues">mergeTagValues</a></li><li data-type="method" id="BagItProfile-mustBeTarred-nav"><a href="BagItProfile.html#mustBeTarred">mustBeTarred</a></li><li data-type="method" id="BagItProfile-preferredSerialization-nav"><a href="BagItProfile.html#preferredSerialization">preferredSerialization</a></li><li data-type="method" id="BagItProfile-suggestBagName-nav"><a href="BagItProfile.html#suggestBagName">suggestBagName</a></li><li data-type="method" id="BagItProfile-tagFileNames-nav"><a href="BagItProfile.html#tagFileNames">tagFileNames</a></li><li data-type="method" id="BagItProfile-tagsGroupedByFile-nav"><a href="BagItProfile.html#tagsGroupedByFile">tagsGroupedByFile</a></li><li data-type="method" id="BagItProfile-validate-nav"><a href="BagItProfile.html#validate">validate</a></li></ul></li><li id="BagItProfileController-nav"><a href="BagItProfileController.html">BagItProfileController</a><ul class='methods'><li data-type="method" id="BagItProfileController-_enterKeyHandler-nav"><a href="BagItProfileController.html#_enterKeyHandler">_enterKeyHandler</a></li><li data-type="method" id="BagItProfileController-_getPageHTML-nav"><a href="BagItProfileController.html#_getPageHTML">_getPageHTML</a></li><li data-type="method" id="BagItProfileController-create-nav"><a href="BagItProfileController.html#create">create</a></li><li data-type="method" id="BagItProfileController-deleteTagDef-nav"><a href="BagItProfileController.html#deleteTagDef">deleteTagDef</a></li><li data-type="method" id="BagItProfileController-edit-nav"><a href="BagItProfileController.html#edit">edit</a></li><li data-type="method" id="BagItProfileController-getNewProfileFromBase-nav"><a href="BagItProfileController.html#getNewProfileFromBase">getNewProfileFromBase</a></li><li data-type="method" id="BagItProfileController-new-nav"><a href="BagItProfileController.html#new">new</a></li><li data-type="method" id="BagItProfileController-newTagFile-nav"><a href="BagItProfileController.html#newTagFile">newTagFile</a></li><li data-type="method" id="BagItProfileController-newTagFileCreate-nav"><a href="BagItProfileController.html#newTagFileCreate">newTagFileCreate</a></li><li data-type="method" id="BagItProfileController-update-nav"><a href="BagItProfileController.html#update">update</a></li></ul></li><li id="BagItProfileForm-nav"><a href="BagItProfileForm.html">BagItProfileForm</a><ul class='methods'><li data-type="method" id="BagItProfileForm-_setProfileInfoFields-nav"><a href="BagItProfileForm.html#_setProfileInfoFields">_setProfileInfoFields</a></li><li data-type="method" id="BagItProfileForm-parseFromDOM-nav"><a href="BagItProfileForm.html#parseFromDOM">parseFromDOM</a></li></ul></li><li id="BagItProfileInfo-nav"><a href="BagItProfileInfo.html">BagItProfileInfo</a></li><li id="BagItUtil-nav"><a href="BagItUtil.html">BagItUtil</a><ul class='methods'><li data-type="method" id="BagItUtil-profileFromStandardJson-nav"><a href="BagItUtil.html#.profileFromStandardJson">profileFromStandardJson</a></li><li data-type="method" id="BagItUtil-profileFromStandardObject-nav"><a href="BagItUtil.html#.profileFromStandardObject">profileFromStandardObject</a></li></ul></li><li id="BaseController-nav"><a href="BaseController.html">BaseController</a><ul class='methods'><li data-type="method" id="BaseController-containerContent-nav"><a href="BaseController.html#containerContent">containerContent</a></li><li data-type="method" id="BaseController-destroy-nav"><a href="BaseController.html#destroy">destroy</a></li><li data-type="method" id="BaseController-edit-nav"><a href="BaseController.html#edit">edit</a></li><li data-type="method" id="BaseController-list-nav"><a href="BaseController.html#list">list</a></li><li data-type="method" id="BaseController-modalContent-nav"><a href="BaseController.html#modalContent">modalContent</a></li><li data-type="method" id="BaseController-new-nav"><a href="BaseController.html#new">new</a></li><li data-type="method" id="BaseController-noContent-nav"><a href="BaseController.html#noContent">noContent</a></li><li data-type="method" id="BaseController-openExternal-nav"><a href="BaseController.html#openExternal">openExternal</a></li><li data-type="method" id="BaseController-paramsToHash-nav"><a href="BaseController.html#paramsToHash">paramsToHash</a></li><li data-type="method" id="BaseController-postRenderCallback-nav"><a href="BaseController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="BaseController-redirect-nav"><a href="BaseController.html#redirect">redirect</a></li><li data-type="method" id="BaseController-update-nav"><a href="BaseController.html#update">update</a></li></ul></li><li id="Choice-nav"><a href="Choice.html">Choice</a><ul class='methods'><li data-type="method" id="Choice-makeList-nav"><a href="Choice.html#.makeList">makeList</a></li></ul></li><li id="DartProcess-nav"><a href="DartProcess.html">DartProcess</a></li><li id="DartProcessController-nav"><a href="DartProcessController.html">DartProcessController</a><ul class='methods'><li data-type="method" id="DartProcessController-list-nav"><a href="DartProcessController.html#list">list</a></li></ul></li><li id="DPNSetup-nav"><a href="DPNSetup.html">DPNSetup</a><ul class='methods'><li data-type="method" id="DPNSetup-description-nav"><a href="DPNSetup.html#.description">description</a></li></ul></li><li id="DummyReader-nav"><a href="DummyReader.html">DummyReader</a><ul class='methods'><li data-type="method" id="DummyReader-_read-nav"><a href="DummyReader.html#_read">_read</a></li></ul></li><li id="FileStat-nav"><a href="FileStat.html">FileStat</a><ul class='methods'><li data-type="method" id="FileStat-isDirectory-nav"><a href="FileStat.html#isDirectory">isDirectory</a></li><li data-type="method" id="FileStat-isFile-nav"><a href="FileStat.html#isFile">isFile</a></li></ul></li><li id="FileSystemReader-nav"><a href="FileSystemReader.html">FileSystemReader</a><ul class='methods'><li data-type="method" id="FileSystemReader-description-nav"><a href="FileSystemReader.html#.description">description</a></li><li data-type="method" id="FileSystemReader-list-nav"><a href="FileSystemReader.html#list">list</a></li><li data-type="method" id="FileSystemReader-read-nav"><a href="FileSystemReader.html#read">read</a></li></ul></li><li id="FileSystemWriter-nav"><a href="FileSystemWriter.html">FileSystemWriter</a><ul class='methods'><li data-type="method" id="FileSystemWriter-description-nav"><a href="FileSystemWriter.html#.description">description</a></li><li data-type="method" id="FileSystemWriter-add-nav"><a href="FileSystemWriter.html#add">add</a></li></ul></li><li id="Form-nav"><a href="Form.html">Form</a><ul class='methods'><li data-type="method" id="Form-_initField-nav"><a href="Form.html#_initField">_initField</a></li><li data-type="method" id="Form-_initFields-nav"><a href="Form.html#_initFields">_initFields</a></li><li data-type="method" id="Form-castNewValueToType-nav"><a href="Form.html#castNewValueToType">castNewValueToType</a></li><li data-type="method" id="Form-hasErrors-nav"><a href="Form.html#hasErrors">hasErrors</a></li><li data-type="method" id="Form-parseFromDOM-nav"><a href="Form.html#parseFromDOM">parseFromDOM</a></li><li data-type="method" id="Form-setErrors-nav"><a href="Form.html#setErrors">setErrors</a></li></ul></li><li id="GlobalContext-nav"><a href="GlobalContext.html">GlobalContext</a><ul class='methods'><li data-type="method" id="GlobalContext-dartReleaseNumber-nav"><a href="GlobalContext.html#dartReleaseNumber">dartReleaseNumber</a></li><li data-type="method" id="GlobalContext-dartVersion-nav"><a href="GlobalContext.html#dartVersion">dartVersion</a></li><li data-type="method" id="GlobalContext-db-nav"><a href="GlobalContext.html#db">db</a></li><li data-type="method" id="GlobalContext-electronIsRunning-nav"><a href="GlobalContext.html#electronIsRunning">electronIsRunning</a></li><li data-type="method" id="GlobalContext-getPackageInfo-nav"><a href="GlobalContext.html#getPackageInfo">getPackageInfo</a></li><li data-type="method" id="GlobalContext-isElectronDevMode-nav"><a href="GlobalContext.html#isElectronDevMode">isElectronDevMode</a></li></ul></li><li id="InternalSetting-nav"><a href="InternalSetting.html">InternalSetting</a><ul class='methods'><li data-type="method" id="InternalSetting-validate-nav"><a href="InternalSetting.html#validate">validate</a></li></ul></li><li id="Job-nav"><a href="Job.html">Job</a><ul class='methods'><li data-type="method" id="Job-find-nav"><a href="Job.html#.find">find</a></li><li data-type="method" id="Job-inflateFrom-nav"><a href="Job.html#.inflateFrom">inflateFrom</a></li><li data-type="method" id="Job-inflateFromFile-nav"><a href="Job.html#.inflateFromFile">inflateFromFile</a></li><li data-type="method" id="Job-getRunErrors-nav"><a href="Job.html#getRunErrors">getRunErrors</a></li><li data-type="method" id="Job-packageAttempted-nav"><a href="Job.html#packageAttempted">packageAttempted</a></li><li data-type="method" id="Job-packagedAt-nav"><a href="Job.html#packagedAt">packagedAt</a></li><li data-type="method" id="Job-packageSucceeded-nav"><a href="Job.html#packageSucceeded">packageSucceeded</a></li><li data-type="method" id="Job-uploadAttempted-nav"><a href="Job.html#uploadAttempted">uploadAttempted</a></li><li data-type="method" id="Job-uploadedAt-nav"><a href="Job.html#uploadedAt">uploadedAt</a></li><li data-type="method" id="Job-uploadSucceeded-nav"><a href="Job.html#uploadSucceeded">uploadSucceeded</a></li><li data-type="method" id="Job-validate-nav"><a href="Job.html#validate">validate</a></li><li data-type="method" id="Job-validatedAt-nav"><a href="Job.html#validatedAt">validatedAt</a></li><li data-type="method" id="Job-validationAttempted-nav"><a href="Job.html#validationAttempted">validationAttempted</a></li><li data-type="method" id="Job-validationSucceeded-nav"><a href="Job.html#validationSucceeded">validationSucceeded</a></li></ul></li><li id="JobController-nav"><a href="JobController.html">JobController</a><ul class='methods'><li data-type="method" id="JobController-colorCodeJobs-nav"><a href="JobController.html#colorCodeJobs">colorCodeJobs</a></li><li data-type="method" id="JobController-list-nav"><a href="JobController.html#list">list</a></li><li data-type="method" id="JobController-new-nav"><a href="JobController.html#new">new</a></li></ul></li><li id="JobFilesController-nav"><a href="JobFilesController.html">JobFilesController</a><ul class='methods'><li data-type="method" id="JobFilesController-addFileToPackageSources-nav"><a href="JobFilesController.html#addFileToPackageSources">addFileToPackageSources</a></li><li data-type="method" id="JobFilesController-addItemsToUI-nav"><a href="JobFilesController.html#addItemsToUI">addItemsToUI</a></li><li data-type="method" id="JobFilesController-addItemToUI-nav"><a href="JobFilesController.html#addItemToUI">addItemToUI</a></li><li data-type="method" id="JobFilesController-addRow-nav"><a href="JobFilesController.html#addRow">addRow</a></li><li data-type="method" id="JobFilesController-attachDeleteEvents-nav"><a href="JobFilesController.html#attachDeleteEvents">attachDeleteEvents</a></li><li data-type="method" id="JobFilesController-attachDragAndDropEvents-nav"><a href="JobFilesController.html#attachDragAndDropEvents">attachDragAndDropEvents</a></li><li data-type="method" id="JobFilesController-findContainingItem-nav"><a href="JobFilesController.html#findContainingItem">findContainingItem</a></li><li data-type="method" id="JobFilesController-getTableRow-nav"><a href="JobFilesController.html#getTableRow">getTableRow</a></li><li data-type="method" id="JobFilesController-postRenderCallback-nav"><a href="JobFilesController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobFilesController-removeItemFromUI-nav"><a href="JobFilesController.html#removeItemFromUI">removeItemFromUI</a></li><li data-type="method" id="JobFilesController-show-nav"><a href="JobFilesController.html#show">show</a></li><li data-type="method" id="JobFilesController-updateTotal-nav"><a href="JobFilesController.html#updateTotal">updateTotal</a></li><li data-type="method" id="JobFilesController-updateTotals-nav"><a href="JobFilesController.html#updateTotals">updateTotals</a></li></ul></li><li id="JobMetadataController-nav"><a href="JobMetadataController.html">JobMetadataController</a><ul class='methods'><li data-type="method" id="JobMetadataController-_attachTagFileAutocomplete-nav"><a href="JobMetadataController.html#_attachTagFileAutocomplete">_attachTagFileAutocomplete</a></li><li data-type="method" id="JobMetadataController-_attachToggleHiddenTags-nav"><a href="JobMetadataController.html#_attachToggleHiddenTags">_attachToggleHiddenTags</a></li><li data-type="method" id="JobMetadataController-_parseMetadataForm-nav"><a href="JobMetadataController.html#_parseMetadataForm">_parseMetadataForm</a></li><li data-type="method" id="JobMetadataController-_validateMetadataForm-nav"><a href="JobMetadataController.html#_validateMetadataForm">_validateMetadataForm</a></li><li data-type="method" id="JobMetadataController-back-nav"><a href="JobMetadataController.html#back">back</a></li><li data-type="method" id="JobMetadataController-newTag-nav"><a href="JobMetadataController.html#newTag">newTag</a></li><li data-type="method" id="JobMetadataController-next-nav"><a href="JobMetadataController.html#next">next</a></li><li data-type="method" id="JobMetadataController-postRenderCallback-nav"><a href="JobMetadataController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobMetadataController-saveNewTag-nav"><a href="JobMetadataController.html#saveNewTag">saveNewTag</a></li><li data-type="method" id="JobMetadataController-show-nav"><a href="JobMetadataController.html#show">show</a></li></ul></li><li id="JobPackageOp-nav"><a href="JobPackageOp.html">JobPackageOp</a></li><li id="JobPackageOpForm-nav"><a href="JobPackageOpForm.html">JobPackageOpForm</a></li><li id="JobPackagingController-nav"><a href="JobPackagingController.html">JobPackagingController</a><ul class='methods'><li data-type="method" id="JobPackagingController-_parseJobPackagingForm-nav"><a href="JobPackagingController.html#_parseJobPackagingForm">_parseJobPackagingForm</a></li><li data-type="method" id="JobPackagingController-_renderPackagingForm-nav"><a href="JobPackagingController.html#_renderPackagingForm">_renderPackagingForm</a></li><li data-type="method" id="JobPackagingController-_updatePackaging-nav"><a href="JobPackagingController.html#_updatePackaging">_updatePackaging</a></li><li data-type="method" id="JobPackagingController-back-nav"><a href="JobPackagingController.html#back">back</a></li><li data-type="method" id="JobPackagingController-next-nav"><a href="JobPackagingController.html#next">next</a></li><li data-type="method" id="JobPackagingController-onFormatChange-nav"><a href="JobPackagingController.html#onFormatChange">onFormatChange</a></li><li data-type="method" id="JobPackagingController-onPackageNameKeyUp-nav"><a href="JobPackagingController.html#onPackageNameKeyUp">onPackageNameKeyUp</a></li><li data-type="method" id="JobPackagingController-postRenderCallback-nav"><a href="JobPackagingController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="JobPackagingController-show-nav"><a href="JobPackagingController.html#show">show</a></li></ul></li><li id="JobRunController-nav"><a href="JobRunController.html">JobRunController</a><ul class='methods'><li data-type="method" id="JobRunController-run-nav"><a href="JobRunController.html#run">run</a></li><li data-type="method" id="JobRunController-show-nav"><a href="JobRunController.html#show">show</a></li></ul></li><li id="JobStatus-nav"><a href="JobStatus.html">JobStatus</a></li><li id="JobTagsForm-nav"><a href="JobTagsForm.html">JobTagsForm</a><ul class='methods'><li data-type="method" id="JobTagsForm-_tagDefToField-nav"><a href="JobTagsForm.html#_tagDefToField">_tagDefToField</a></li></ul></li><li id="JobUploadController-nav"><a href="JobUploadController.html">JobUploadController</a><ul class='methods'><li data-type="method" id="JobUploadController-back-nav"><a href="JobUploadController.html#back">back</a></li><li data-type="method" id="JobUploadController-next-nav"><a href="JobUploadController.html#next">next</a></li><li data-type="method" id="JobUploadController-show-nav"><a href="JobUploadController.html#show">show</a></li></ul></li><li id="JobUploadForm-nav"><a href="JobUploadForm.html">JobUploadForm</a></li><li id="JsonStore-nav"><a href="JsonStore.html">JsonStore</a></li><li id="KeyValueCollection-nav"><a href="KeyValueCollection.html">KeyValueCollection</a><ul class='methods'><li data-type="method" id="KeyValueCollection-add-nav"><a href="KeyValueCollection.html#add">add</a></li><li data-type="method" id="KeyValueCollection-all-nav"><a href="KeyValueCollection.html#all">all</a></li><li data-type="method" id="KeyValueCollection-first-nav"><a href="KeyValueCollection.html#first">first</a></li><li data-type="method" id="KeyValueCollection-keys-nav"><a href="KeyValueCollection.html#keys">keys</a></li><li data-type="method" id="KeyValueCollection-sortedKeys-nav"><a href="KeyValueCollection.html#sortedKeys">sortedKeys</a></li></ul></li><li id="ManifestEntry-nav"><a href="ManifestEntry.html">ManifestEntry</a><ul class='methods'><li data-type="method" id="ManifestEntry-validate-nav"><a href="ManifestEntry.html#validate">validate</a></li></ul></li><li id="ManifestParser-nav"><a href="ManifestParser.html">ManifestParser</a></li><li id="NewBagItProfileForm-nav"><a href="NewBagItProfileForm.html">NewBagItProfileForm</a></li><li id="OperationResult-nav"><a href="OperationResult.html">OperationResult</a><ul class='methods'><li data-type="method" id="OperationResult-inflateFrom-nav"><a href="OperationResult.html#.inflateFrom">inflateFrom</a></li><li data-type="method" id="OperationResult-finish-nav"><a href="OperationResult.html#finish">finish</a></li><li data-type="method" id="OperationResult-firstError-nav"><a href="OperationResult.html#firstError">firstError</a></li><li data-type="method" id="OperationResult-hasErrors-nav"><a href="OperationResult.html#hasErrors">hasErrors</a></li><li data-type="method" id="OperationResult-lastError-nav"><a href="OperationResult.html#lastError">lastError</a></li><li data-type="method" id="OperationResult-reset-nav"><a href="OperationResult.html#reset">reset</a></li><li data-type="method" id="OperationResult-start-nav"><a href="OperationResult.html#start">start</a></li><li data-type="method" id="OperationResult-succeeded-nav"><a href="OperationResult.html#succeeded">succeeded</a></li></ul></li><li id="PackageOperation-nav"><a href="PackageOperation.html">PackageOperation</a><ul class='methods'><li data-type="method" id="PackageOperation-inflateFrom-nav"><a href="PackageOperation.html#.inflateFrom">inflateFrom</a></li><li data-type="method" id="PackageOperation-getWriter-nav"><a href="PackageOperation.html#getWriter">getWriter</a></li><li data-type="method" id="PackageOperation-pruneSourceFilesUnlessJobCompleted-nav"><a href="PackageOperation.html#pruneSourceFilesUnlessJobCompleted">pruneSourceFilesUnlessJobCompleted</a></li><li data-type="method" id="PackageOperation-validate-nav"><a href="PackageOperation.html#validate">validate</a></li></ul></li><li id="PersistentObject-nav"><a href="PersistentObject.html">PersistentObject</a><ul class='methods'><li data-type="method" id="PersistentObject-find-nav"><a href="PersistentObject.html#.find">find</a></li><li data-type="method" id="PersistentObject-findMatching-nav"><a href="PersistentObject.html#.findMatching">findMatching</a></li><li data-type="method" id="PersistentObject-first-nav"><a href="PersistentObject.html#.first">first</a></li><li data-type="method" id="PersistentObject-firstMatching-nav"><a href="PersistentObject.html#.firstMatching">firstMatching</a></li><li data-type="method" id="PersistentObject-list-nav"><a href="PersistentObject.html#.list">list</a></li><li data-type="method" id="PersistentObject-mergeDefaultOpts-nav"><a href="PersistentObject.html#.mergeDefaultOpts">mergeDefaultOpts</a></li><li data-type="method" id="PersistentObject-sort-nav"><a href="PersistentObject.html#.sort">sort</a></li><li data-type="method" id="PersistentObject-delete-nav"><a href="PersistentObject.html#delete">delete</a></li><li data-type="method" id="PersistentObject-save-nav"><a href="PersistentObject.html#save">save</a></li><li data-type="method" id="PersistentObject-validate-nav"><a href="PersistentObject.html#validate">validate</a></li></ul></li><li id="Plugin-nav"><a href="Plugin.html">Plugin</a><ul class='methods'><li data-type="method" id="Plugin-description-nav"><a href="Plugin.html#.description">description</a></li></ul></li><li id="PluginManager-nav"><a href="PluginManager.html">PluginManager</a><ul class='methods'><li data-type="method" id="PluginManager-canRead-nav"><a href="PluginManager.html#.canRead">canRead</a></li><li data-type="method" id="PluginManager-canWrite-nav"><a href="PluginManager.html#.canWrite">canWrite</a></li><li data-type="method" id="PluginManager-findById-nav"><a href="PluginManager.html#.findById">findById</a></li><li data-type="method" id="PluginManager-getModuleCollection-nav"><a href="PluginManager.html#.getModuleCollection">getModuleCollection</a></li><li data-type="method" id="PluginManager-implementsProtocol-nav"><a href="PluginManager.html#.implementsProtocol">implementsProtocol</a></li><li data-type="method" id="PluginManager-pluginProvides-nav"><a href="PluginManager.html#.pluginProvides">pluginProvides</a></li><li data-type="method" id="PluginManager-setsUp-nav"><a href="PluginManager.html#.setsUp">setsUp</a></li><li data-type="method" id="PluginManager-talksTo-nav"><a href="PluginManager.html#.talksTo">talksTo</a></li><li data-type="method" id="PluginManager-types-nav"><a href="PluginManager.html#.types">types</a></li></ul></li><li id="Popper-nav"><a href="Popper.html">Popper</a><ul class='methods'><li data-type="method" id="Popper-destroy-nav"><a href="Popper.html#.destroy">destroy</a></li><li data-type="method" id="Popper-disableEventListeners-nav"><a href="Popper.html#.disableEventListeners">disableEventListeners</a></li><li data-type="method" id="Popper-enableEventListeners-nav"><a href="Popper.html#.enableEventListeners">enableEventListeners</a></li><li data-type="method" id="Popper-placements-nav"><a href="Popper.html#.placements">placements</a></li><li data-type="method" id="Popper-update-nav"><a href="Popper.html#.update">update</a></li></ul></li><li id="RemoteRepository-nav"><a href="RemoteRepository.html">RemoteRepository</a><ul class='methods'><li data-type="method" id="RemoteRepository-validate-nav"><a href="RemoteRepository.html#validate">validate</a></li></ul></li><li id="S3Client-nav"><a href="S3Client.html">S3Client</a><ul class='methods'><li data-type="method" id="S3Client-description-nav"><a href="S3Client.html#.description">description</a></li><li data-type="method" id="S3Client-download-nav"><a href="S3Client.html#download">download</a></li><li data-type="method" id="S3Client-exists-nav"><a href="S3Client.html#exists">exists</a></li><li data-type="method" id="S3Client-list-nav"><a href="S3Client.html#list">list</a></li><li data-type="method" id="S3Client-upload-nav"><a href="S3Client.html#upload">upload</a></li></ul></li><li id="S3Transfer-nav"><a href="S3Transfer.html">S3Transfer</a><ul class='methods'><li data-type="method" id="S3Transfer-getRemoteUrl-nav"><a href="S3Transfer.html#getRemoteUrl">getRemoteUrl</a></li></ul></li><li id="SetupBase-nav"><a href="SetupBase.html">SetupBase</a><ul class='methods'><li data-type="method" id="SetupBase-_getPathToMessageFile-nav"><a href="SetupBase.html#_getPathToMessageFile">_getPathToMessageFile</a></li><li data-type="method" id="SetupBase-afterAllQuestions-nav"><a href="SetupBase.html#afterAllQuestions">afterAllQuestions</a></li><li data-type="method" id="SetupBase-afterEachQuestion-nav"><a href="SetupBase.html#afterEachQuestion">afterEachQuestion</a></li><li data-type="method" id="SetupBase-beforeAllQuestions-nav"><a href="SetupBase.html#beforeAllQuestions">beforeAllQuestions</a></li><li data-type="method" id="SetupBase-beforeObjectInstallation-nav"><a href="SetupBase.html#beforeObjectInstallation">beforeObjectInstallation</a></li><li data-type="method" id="SetupBase-getMessage-nav"><a href="SetupBase.html#getMessage">getMessage</a></li><li data-type="method" id="SetupBase-getQuestions-nav"><a href="SetupBase.html#getQuestions">getQuestions</a></li><li data-type="method" id="SetupBase-installSettings-nav"><a href="SetupBase.html#installSettings">installSettings</a></li><li data-type="method" id="SetupBase-setCompletionTimestamp-nav"><a href="SetupBase.html#setCompletionTimestamp">setCompletionTimestamp</a></li></ul></li><li id="SetupController-nav"><a href="SetupController.html">SetupController</a><ul class='methods'><li data-type="method" id="SetupController-_formatLastRunDate-nav"><a href="SetupController.html#_formatLastRunDate">_formatLastRunDate</a></li><li data-type="method" id="SetupController-_getLastRunDate-nav"><a href="SetupController.html#_getLastRunDate">_getLastRunDate</a></li><li data-type="method" id="SetupController-end-nav"><a href="SetupController.html#end">end</a></li><li data-type="method" id="SetupController-getLogoPath-nav"><a href="SetupController.html#getLogoPath">getLogoPath</a></li><li data-type="method" id="SetupController-list-nav"><a href="SetupController.html#list">list</a></li><li data-type="method" id="SetupController-postRenderCallback-nav"><a href="SetupController.html#postRenderCallback">postRenderCallback</a></li><li data-type="method" id="SetupController-question-nav"><a href="SetupController.html#question">question</a></li><li data-type="method" id="SetupController-runPreQuestionCallbacks-nav"><a href="SetupController.html#runPreQuestionCallbacks">runPreQuestionCallbacks</a></li><li data-type="method" id="SetupController-start-nav"><a href="SetupController.html#start">start</a></li><li data-type="method" id="SetupController-startQuestions-nav"><a href="SetupController.html#startQuestions">startQuestions</a></li></ul></li><li id="SetupQuestion-nav"><a href="SetupQuestion.html">SetupQuestion</a><ul class='methods'><li data-type="method" id="SetupQuestion-getIntRangeValidator-nav"><a href="SetupQuestion.html#.getIntRangeValidator">getIntRangeValidator</a></li><li data-type="method" id="SetupQuestion-getPatternValidator-nav"><a href="SetupQuestion.html#.getPatternValidator">getPatternValidator</a></li><li data-type="method" id="SetupQuestion-getRequiredValidator-nav"><a href="SetupQuestion.html#.getRequiredValidator">getRequiredValidator</a></li><li data-type="method" id="SetupQuestion-_setValidationRegExp-nav"><a href="SetupQuestion.html#_setValidationRegExp">_setValidationRegExp</a></li><li data-type="method" id="SetupQuestion-getValidators-nav"><a href="SetupQuestion.html#getValidators">getValidators</a></li><li data-type="method" id="SetupQuestion-looksLikeNumericValidation-nav"><a href="SetupQuestion.html#looksLikeNumericValidation">looksLikeNumericValidation</a></li><li data-type="method" id="SetupQuestion-processResponse-nav"><a href="SetupQuestion.html#processResponse">processResponse</a></li><li data-type="method" id="SetupQuestion-readUserInput-nav"><a href="SetupQuestion.html#readUserInput">readUserInput</a></li><li data-type="method" id="SetupQuestion-saveValue-nav"><a href="SetupQuestion.html#saveValue">saveValue</a></li><li data-type="method" id="SetupQuestion-setInitialValue-nav"><a href="SetupQuestion.html#setInitialValue">setInitialValue</a></li><li data-type="method" id="SetupQuestion-validate-nav"><a href="SetupQuestion.html#validate">validate</a></li></ul></li><li id="StorageService-nav"><a href="StorageService.html">StorageService</a><ul class='methods'><li data-type="method" id="StorageService-getValue-nav"><a href="StorageService.html#getValue">getValue</a></li><li data-type="method" id="StorageService-url-nav"><a href="StorageService.html#url">url</a></li><li data-type="method" id="StorageService-validate-nav"><a href="StorageService.html#validate">validate</a></li></ul></li><li id="TagDefinition-nav"><a href="TagDefinition.html">TagDefinition</a><ul class='methods'><li data-type="method" id="TagDefinition-fromCommandLineArg-nav"><a href="TagDefinition.html#.fromCommandLineArg">fromCommandLineArg</a></li><li data-type="method" id="TagDefinition-getValue-nav"><a href="TagDefinition.html#getValue">getValue</a></li><li data-type="method" id="TagDefinition-looksLikeDescriptionTag-nav"><a href="TagDefinition.html#looksLikeDescriptionTag">looksLikeDescriptionTag</a></li><li data-type="method" id="TagDefinition-systemMustSet-nav"><a href="TagDefinition.html#systemMustSet">systemMustSet</a></li><li data-type="method" id="TagDefinition-toFormattedString-nav"><a href="TagDefinition.html#toFormattedString">toFormattedString</a></li><li data-type="method" id="TagDefinition-validate-nav"><a href="TagDefinition.html#validate">validate</a></li><li data-type="method" id="TagDefinition-validateForJob-nav"><a href="TagDefinition.html#validateForJob">validateForJob</a></li></ul></li><li id="TagFileForm-nav"><a href="TagFileForm.html">TagFileForm</a></li><li id="TagFileParser-nav"><a href="TagFileParser.html">TagFileParser</a></li><li id="TarReader-nav"><a href="TarReader.html">TarReader</a><ul class='methods'><li data-type="method" id="TarReader-description-nav"><a href="TarReader.html#.description">description</a></li><li data-type="method" id="TarReader-list-nav"><a href="TarReader.html#list">list</a></li><li data-type="method" id="TarReader-read-nav"><a href="TarReader.html#read">read</a></li></ul></li><li id="TarWriter-nav"><a href="TarWriter.html">TarWriter</a><ul class='methods'><li data-type="method" id="TarWriter-description-nav"><a href="TarWriter.html#.description">description</a></li><li data-type="method" id="TarWriter-add-nav"><a href="TarWriter.html#add">add</a></li></ul></li><li id="TaskDescription-nav"><a href="TaskDescription.html">TaskDescription</a></li><li id="TestUtil-nav"><a href="TestUtil.html">TestUtil</a><ul class='methods'><li data-type="method" id="TestUtil-deleteJsonFile-nav"><a href="TestUtil.html#.deleteJsonFile">deleteJsonFile</a></li><li data-type="method" id="TestUtil-loadProfile-nav"><a href="TestUtil.html#.loadProfile">loadProfile</a></li><li data-type="method" id="TestUtil-loadProfilesFromSetup-nav"><a href="TestUtil.html#.loadProfilesFromSetup">loadProfilesFromSetup</a></li></ul></li><li id="UploadOperation-nav"><a href="UploadOperation.html">UploadOperation</a><ul class='methods'><li data-type="method" id="UploadOperation-inflateFrom-nav"><a href="UploadOperation.html#.inflateFrom">inflateFrom</a></li><li data-type="method" id="UploadOperation-validate-nav"><a href="UploadOperation.html#validate">validate</a></li></ul></li><li id="UploadTestHelper-nav"><a href="UploadTestHelper.html">UploadTestHelper</a><ul class='methods'><li data-type="method" id="UploadTestHelper-envHasS3Credentials-nav"><a href="UploadTestHelper.html#envHasS3Credentials">envHasS3Credentials</a></li><li data-type="method" id="UploadTestHelper-getStorageService-nav"><a href="UploadTestHelper.html#getStorageService">getStorageService</a></li></ul></li><li id="Util-nav"><a href="Util.html">Util</a><ul class='methods'><li data-type="method" id="Util-bagNameFromPath-nav"><a href="Util.html#.bagNameFromPath">bagNameFromPath</a></li><li data-type="method" id="Util-boolEqual-nav"><a href="Util.html#.boolEqual">boolEqual</a></li><li data-type="method" id="Util-boolValue-nav"><a href="Util.html#.boolValue">boolValue</a></li><li data-type="method" id="Util-camelToTitle-nav"><a href="Util.html#.camelToTitle">camelToTitle</a></li><li data-type="method" id="Util-cast-nav"><a href="Util.html#.cast">cast</a></li><li data-type="method" id="Util-deleteFromArray-nav"><a href="Util.html#.deleteFromArray">deleteFromArray</a></li><li data-type="method" id="Util-deleteRecursive-nav"><a href="Util.html#.deleteRecursive">deleteRecursive</a></li><li data-type="method" id="Util-escapeBackslashes-nav"><a href="Util.html#.escapeBackslashes">escapeBackslashes</a></li><li data-type="method" id="Util-filterEmptyStrings-nav"><a href="Util.html#.filterEmptyStrings">filterEmptyStrings</a></li><li data-type="method" id="Util-getEnvSetting-nav"><a href="Util.html#.getEnvSetting">getEnvSetting</a></li><li data-type="method" id="Util-getSortFunction-nav"><a href="Util.html#.getSortFunction">getSortFunction</a></li><li data-type="method" id="Util-isEmpty-nav"><a href="Util.html#.isEmpty">isEmpty</a></li><li data-type="method" id="Util-isEmptyStringArray-nav"><a href="Util.html#.isEmptyStringArray">isEmptyStringArray</a></li><li data-type="method" id="Util-lcFirst-nav"><a href="Util.html#.lcFirst">lcFirst</a></li><li data-type="method" id="Util-listContains-nav"><a href="Util.html#.listContains">listContains</a></li><li data-type="method" id="Util-looksLikeEnvSetting-nav"><a href="Util.html#.looksLikeEnvSetting">looksLikeEnvSetting</a></li><li data-type="method" id="Util-looksLikeHypertextURL-nav"><a href="Util.html#.looksLikeHypertextURL">looksLikeHypertextURL</a></li><li data-type="method" id="Util-looksLikeUUID-nav"><a href="Util.html#.looksLikeUUID">looksLikeUUID</a></li><li data-type="method" id="Util-normalizeWindowsPath-nav"><a href="Util.html#.normalizeWindowsPath">normalizeWindowsPath</a></li><li data-type="method" id="Util-tmpFilePath-nav"><a href="Util.html#.tmpFilePath">tmpFilePath</a></li><li data-type="method" id="Util-toHumanSize-nav"><a href="Util.html#.toHumanSize">toHumanSize</a></li><li data-type="method" id="Util-truncateString-nav"><a href="Util.html#.truncateString">truncateString</a></li><li data-type="method" id="Util-unicodeByteLength-nav"><a href="Util.html#.unicodeByteLength">unicodeByteLength</a></li><li data-type="method" id="Util-uuid4-nav"><a href="Util.html#.uuid4">uuid4</a></li><li data-type="method" id="Util-walkSync-nav"><a href="Util.html#.walkSync">walkSync</a></li></ul></li><li id="ValidationOperation-nav"><a href="ValidationOperation.html">ValidationOperation</a><ul class='methods'><li data-type="method" id="ValidationOperation-inflateFrom-nav"><a href="ValidationOperation.html#.inflateFrom">inflateFrom</a></li><li data-type="method" id="ValidationOperation-validate-nav"><a href="ValidationOperation.html#validate">validate</a></li></ul></li><li id="Validator-nav"><a href="Validator.html">Validator</a><ul class='methods'><li data-type="method" id="Validator-_addBagItFile-nav"><a href="Validator.html#_addBagItFile">_addBagItFile</a></li><li data-type="method" id="Validator-_cleanEntryRelPath-nav"><a href="Validator.html#_cleanEntryRelPath">_cleanEntryRelPath</a></li><li data-type="method" id="Validator-_expectedTopLevelFiles-nav"><a href="Validator.html#_expectedTopLevelFiles">_expectedTopLevelFiles</a></li><li data-type="method" id="Validator-_getCryptoHashes-nav"><a href="Validator.html#_getCryptoHashes">_getCryptoHashes</a></li><li data-type="method" id="Validator-_readBag-nav"><a href="Validator.html#_readBag">_readBag</a></li><li data-type="method" id="Validator-_readEntry-nav"><a href="Validator.html#_readEntry">_readEntry</a></li><li data-type="method" id="Validator-_readFile-nav"><a href="Validator.html#_readFile">_readFile</a></li><li data-type="method" id="Validator-_scanBag-nav"><a href="Validator.html#_scanBag">_scanBag</a></li><li data-type="method" id="Validator-_validateFormatAndContents-nav"><a href="Validator.html#_validateFormatAndContents">_validateFormatAndContents</a></li><li data-type="method" id="Validator-_validateManifestEntries-nav"><a href="Validator.html#_validateManifestEntries">_validateManifestEntries</a></li><li data-type="method" id="Validator-_validateNoExtraneousPayloadFiles-nav"><a href="Validator.html#_validateNoExtraneousPayloadFiles">_validateNoExtraneousPayloadFiles</a></li><li data-type="method" id="Validator-_validatePayloadOxum-nav"><a href="Validator.html#_validatePayloadOxum">_validatePayloadOxum</a></li><li data-type="method" id="Validator-_validateProfile-nav"><a href="Validator.html#_validateProfile">_validateProfile</a></li><li data-type="method" id="Validator-_validateRequiredManifests-nav"><a href="Validator.html#_validateRequiredManifests">_validateRequiredManifests</a></li><li data-type="method" id="Validator-_validateSerialization-nav"><a href="Validator.html#_validateSerialization">_validateSerialization</a></li><li data-type="method" id="Validator-_validateSerializationFormat-nav"><a href="Validator.html#_validateSerializationFormat">_validateSerializationFormat</a></li><li data-type="method" id="Validator-_validateTags-nav"><a href="Validator.html#_validateTags">_validateTags</a></li><li data-type="method" id="Validator-_validateTopLevelDirs-nav"><a href="Validator.html#_validateTopLevelDirs">_validateTopLevelDirs</a></li><li data-type="method" id="Validator-_validateTopLevelFiles-nav"><a href="Validator.html#_validateTopLevelFiles">_validateTopLevelFiles</a></li><li data-type="method" id="Validator-_validateUntarDirectory-nav"><a href="Validator.html#_validateUntarDirectory">_validateUntarDirectory</a></li><li data-type="method" id="Validator-fileExtension-nav"><a href="Validator.html#fileExtension">fileExtension</a></li><li data-type="method" id="Validator-getNewReader-nav"><a href="Validator.html#getNewReader">getNewReader</a></li><li data-type="method" id="Validator-payloadFiles-nav"><a href="Validator.html#payloadFiles">payloadFiles</a></li><li data-type="method" id="Validator-payloadManifests-nav"><a href="Validator.html#payloadManifests">payloadManifests</a></li><li data-type="method" id="Validator-readingFromDir-nav"><a href="Validator.html#readingFromDir">readingFromDir</a></li><li data-type="method" id="Validator-readingFromTar-nav"><a href="Validator.html#readingFromTar">readingFromTar</a></li><li data-type="method" id="Validator-tagFiles-nav"><a href="Validator.html#tagFiles">tagFiles</a></li><li data-type="method" id="Validator-tagManifests-nav"><a href="Validator.html#tagManifests">tagManifests</a></li><li data-type="method" id="Validator-validate-nav"><a href="Validator.html#validate">validate</a></li></ul></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#Config">Config</a></li><li><a href="global.html#Constants">Constants</a></li><li><a href="global.html#dataObject">dataObject</a></li><li><a href="global.html#FATAL_UPLOAD_ERRORS">FATAL_UPLOAD_ERRORS</a></li><li><a href="global.html#loadBuiltInProfiles">loadBuiltInProfiles</a></li><li><a href="global.html#ModifierFn">ModifierFn</a></li><li><a href="global.html#OPTS">OPTS</a></li><li><a href="global.html#pluginTypes">pluginTypes</a></li><li><a href="global.html#referenceObject">referenceObject</a></li><li><a href="global.html#run">run</a></li><li><a href="global.html#runAll">runAll</a></li><li><a href="global.html#tagsByFileAndName">tagsByFileAndName</a></li><li><a href="global.html#tagsSetBySystem">tagsSetBySystem</a></li><li><a href="global.html#titleTags">titleTags</a></li><li><a href="global.html#UIConstants">UIConstants</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        bagit/validator.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>const { BagItFile } = require('./bagit_file');
const { Constants } = require('../core/constants');
const { Context } = require('../core/context');
const crypto = require('crypto');
const EventEmitter = require('events');
const fs = require('fs');
const { ManifestParser } = require('./manifest_parser');
const os = require('os');
const path = require('path');
const { PluginManager } = require('../plugins/plugin_manager');
const stream = require('stream');
const { TagFileParser } = require('./tag_file_parser');
const { TaskDescription } = require('./task_description');
const { Util } = require('../core/util');

/**
 * Validator validates BagIt packages (tarred or in directory format)
 * according to a BagIt profile.
 *
 * See the validate() method for a list of events.
 *
 */
class Validator extends EventEmitter {

    /**
     * Constructs a new BagIt validator.
     *
     * @param {string} pathToBag is the absolute path the the bag,
     * whether it's a directory or a tar file.
     *
     * @param {BagItProfile} profile is the BagItProfile that describes
     * what consititutes a valid bag.
     *
     */
    constructor(pathToBag, profile) {
        super();
        /**
         * pathToBag is the path to the directory or tar file that
         * contains the bag you want to validate.
         *
         * @type {string}
         */
        this.pathToBag = pathToBag;
        /**
         * profile is the BagItProfile against which we will validate
         * the bag.
         *
         * @type {BagItProfile}
         */
        this.profile = profile;
        /**
         * bagName is the calculated name of the bag, which will be either
         * the name of the directory that contains the bag files, or the name
         * of the tar file, minus the .tar extension. You can override this
         * by setting it explicitly.
         *
         * @type {BagItProfile}
         */
        this.bagName = path.basename(pathToBag, '.tar');
        /**
         * bagRoot is the name of the top-level folder to which a tarred
         * bag untars. The folder name should match the bag name.
         *
         * E.g. "bag123.tar" should untar to bagRoot "bag123"
         *
         * For non-tarred bags, this property will be null.
         *
         * @type {string}
         */
        this.bagRoot = null;
        /**
         * files is a hash of BagItFiles, where the file's path
         * within the bag (relPath) is the key, and the BagItFile
         * object is the value. The hash makes it easy to get files
         * by relative path within the archive (e.g. data/photos/img.jpg).
         *
         * @type {object.&lt;string, BagItFile>}
        */
        this.files = {};
        /**
         * topLevelDirs is a list of strings representing the relative
         * paths of all of the directories found at the top level of the
         * bag. The "data" directory should always be in this list, if a
         * bag is valid. The validator tracks these because some BagItProfiles
         * allow top-level directories other than "data" and some do not.
         *
         * @type {Array&lt;string>}
         */
        this.topLevelDirs = [];
        /**
         * topLevelFiles is a list of strings representing the relative
         * paths of all of the files found at the top level of the
         * bag. The "bagit.txt" and "bag-info.txt" files along with at least
         * one paylowd manifest should always be in this list if a bag is valid.
         * The validator tracks these because  some BagItProfiles allow additional
         * top-level files (other than required tag files and manifests) and some
         * do not.
         *
         * @type {Array&lt;string>}
         */
        this.topLevelFiles = [];
        /**
         * This is a list of manifest algorithms found during an initial
         * scan of the bag. While some BagItProfiles specify that a manifest
         * with algorithm X must be present, the profile does preclude other
         * manifests with different algorithms also being present. It's
         * common among APTrust bags, for example, to find both md5 and sha256
         * manifests. The validator does an initial scan of the bag to find
         * extra manifests so it knows which checksums to run on payload and
         * tag files.
         *
         * If an initial scan reveals manifest-md5.txt and manifest-sha256.txt,
         * the manifestAlgorithmsFoundInBag will contain ["md5", "sha256"].
         *
         * See also {@link _scanBag}.
         *
         * @type {Array&lt;string>}
         */
        this.manifestAlgorithmsFoundInBag = [];
        /**
         * errors is a list of error messages describing problems encountered
         * while trying to validate the bag or specific violations of the
         * BagItProfile that render this bag invalid.
         *
         * @type {Array&lt;string>}
         */
        this.errors = [];
        /**
         * When set to true, this flag tells the validator not to validate
         * the bag serialization format. You'll want to disable this in cases
         * where you're trying to validate an unserialized (i.e. not tarred
         * or zipped or otherwise packaged) bag from a directory against a
         * profile that says the bag must be tarreed, zipped, etc. Because
         * sometimes you build a bag and you want to validate it before you
         * zip it or after you untar it.
         *
         * @type {boolean}
         * @default false
         */
        this.disableSerializationCheck = false;
        /**
         * This is a private internal variable that keeps track of the number
         * of checksum digests currently being calculated. This is part of a
         * lovely hack.
         *
         * @type {number}
         * @default 0
         */
        this._hashesInProgress = 0;
    }

    /**
     * readingFromTar returns true if the bag being validated is in tar format.
     *
     * @deprecated Will be removed soon.
     *
     * @returns {boolean}
     */
    readingFromTar() {
        // TODO: Remove me!
        return this.pathToBag.endsWith('.tar');
    }

    /**
     * readingFromDir returns true if the bag being validated is
     * unserialized. That is, it is a directory on a file system, and not
     * a tar, zip, gzip, or other single-file format.
     *
     * @returns {boolean}
     */
    readingFromDir() {
        return fs.existsSync(this.pathToBag) &amp;&amp; fs.statSync(this.pathToBag).isDirectory();
    }

    /**
     * This returns the file extension of the bag in this.pathToBag.
     * If the bag is a directory, this returns an empty string, but
     * you should still check on your own to see whether pathToBag
     * points to a directory. In the special (and common) case of
     * '.tar.gz' files, this returns '.tar.gz'.
     *
     * @returns {string}
     */
    fileExtension() {
        var ext = path.extname(this.pathToBag);
        if (this.pathToBag.endsWith('.tar.gz')) {
            ext = '.tar.gz';
        }
        return ext;
    }

    /**
     * Returns an array of BagItFile objects that represent payload files.
     *
     * @returns {Array&lt;BagItFile>}
     */
    payloadFiles() {
        return Object.values(this.files).filter(f => f.isPayloadFile());
    }

    /**
     * Returns an array of BagItFile objects that represent payload manifests.
     *
     * @returns {Array&lt;BagItFile>}
     */
    payloadManifests() {
        return Object.values(this.files).filter(f => f.isPayloadManifest());
    }

    /**
     * Returns an array of BagItFile objects that represent tag files.
     *
     * @returns {Array&lt;BagItFile>}
     */
    tagFiles() {
        return Object.values(this.files).filter(f => f.isTagFile());
    }

    /**
     * Returns an array of BagItFile objects that represent tag manifests.
     *
     * @returns {Array&lt;BagItFile>}
     */
    tagManifests() {
        return Object.values(this.files).filter(f => f.isTagManifest());
    }

    /**
     * Returns a reader plugin that is capable of reading the bag we want
     * to validate. Note that this always returns a new reader, so if you
     * call it 20 times, you're going to get 20 individual reader objects.
     *
     * @returns {Plugin}
     */
    getNewReader() {
        var fileExtension = path.extname(this.pathToBag);
        if (this.readingFromDir()) {
            fileExtension = 'directory';
        }
        var plugins = PluginManager.canRead(fileExtension);
        if (!plugins) {
            throw new Error(`No plugins know how to read ${this.pathToBag}`);
        }
        // plugins[0] is a reader plugin (a class) with a constructor
        // that takes pathToBag as its sole param.
        return new plugins[0](this.pathToBag);
    }

    /**
     * validate runs all validation operations on the bag specified in the
     * validator's pathToBag property. This includes:
     *
     * * making sure the untarred bag name matches the tarred bag name
     * * validation checksums for all payload files, and for tag files that have checksums
     * * ensuring there are no extra or missing payload files
     * * ensuring that required tag files and manifests are present and valid
     * * ensuring that required tags are present and, where applicable, have legal values
     *
     * This method emits events "start", "task", "end", and "error".
     */
    validate() {
        this.emit('validateStart', `Validating ${this.pathToBag}`);
        if (!fs.existsSync(this.pathToBag)) {
            let msg = Context.y18n.__('File does not exist at %s', this.pathToBag);
            this.errors.push(msg);
            this.emit('error', msg);
            this.emit('end');
            return;
        }
        if (!this._validateProfile()) {
            this.emit('error', this.errors.join(' '));
            this.emit('end');
            return;
        }
        if (!this._validateSerialization()) {
            this.emit('error', this.errors.join(' '));
            this.emit('end')
            return;
        }

        this.emit('task', new TaskDescription(this.pathToBag, 'start'))

        // Scan the bag for manifests. When that completes, it will
        // call _readBag() to read the contents.
        this._scanBag();
    }

    /**
     * This method does an initial scan of the bag to see what manifests
     * are present. While some BagItProfiles specify that a manifest
     * with algorithm X must be present, the profile does preclude other
     * manifests with different algorithms also being present. It's
     * common among APTrust bags, for example, to find both md5 and sha256
     * manifests. The validator does an initial scan of the bag to find
     * extra manifests so it knows which checksums to run on payload and
     * tag files.
     *
     * If an initial scan reveals manifest-md5.txt and manifest-sha256.txt,
     * the manifestAlgorithmsFoundInBag will contain ["md5", "sha256"].
     *
     * The most common reason for finding multiple manifests in a bag
     * comes from institutions that internally require one checksumming
     * algorithm, and who have to produce bags whose spec requires a
     * different algorithm.
     *
     * The validator will later validate ALL checksums, even those found
     * in manifests that are not part of the {@link BagItProfile}.
     *
     */
    _scanBag() {
        var validator = this;
        var reader = this.getNewReader();
        reader.on('error', function(err) {
            validator.emit('error', err);
        });
        reader.on('entry', function (entry) {
            if (validator.bagRoot == null &amp;&amp; validator.readingFromTar()) {
                validator.bagRoot = entry.relPath.split(/\//)[0];
            }
            var relPath = validator._cleanEntryRelPath(entry.relPath);
            if (relPath.match(Constants.RE_MANIFEST) || relPath.match(Constants.RE_TAG_MANIFEST)) {
                var algorithm = relPath.split('-')[1].split('.')[0];
                if (!validator.manifestAlgorithmsFoundInBag.includes(algorithm)) {
                    validator.manifestAlgorithmsFoundInBag.push(algorithm);
                }
            }
        });
        reader.on('end', function() {
            validator._readBag();
        });

        // List the contents of the bag.
        reader.list();
    }

    /**
     * This method reads the contents of the bag. The actual work is done
     * in the callbacks. When reading is complete, this calls
     * _validateFormatAndContents()
     *
     */
    _readBag() {
        // Attach listeners to our reader.
        var validator = this;
        var reader = this.getNewReader();
        reader.on('entry', function (entry) { validator._readEntry(entry) });
        reader.on('error', function(err) { validator.emit('error', err) });

        // Once reading is done, validate all the info we've gathered.
        reader.on('end', function() {
            // Is this really what we want to emit here?
            validator.emit('task', new TaskDescription(validator.pathToBag, 'read'))
            // FileSystemReader emits end event while streamreader is
            // still piping file contents to our hashing algorithms. We want
            // those hash pipes to complete before validating checksums in
            // _validateFormatAndContents(), so we don't wind up with
            // undefined checksums. The lag time between end event and the
            // completion of checksums is usually ~5ms. Not sure of a better
            // way to do this, given that we have an unknown number of pipes
            // on each file. Don't want to go full async with promises, because
            // we don't want 10,000 open file handles. So... this.
            let hashInterval = setInterval(() => {
                if (validator._hashesInProgress === 0) {
                    clearInterval(hashInterval);
                    validator._validateFormatAndContents();
                }
            }, 50);
        });

        // Read the contents of the bag.
        reader.read();
    }

    /**
     * _validateFormatAndContents is called internally by the public validate()
     * method. While validate() reads the contents of the bag, parses manifests
     * and tag files, this method compares the info in the bag to what the
     * {@link BagItProfile} says is valid.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     */
    _validateFormatAndContents() {
        var okToProceed = this._validateUntarDirectory();
        if (okToProceed) {
            // ------------------------------------------
            // TODO: Validate fetch.txt
            // ------------------------------------------
            this._validateTopLevelDirs();
            this._validateTopLevelFiles();
            this._validateRequiredManifests(Constants.PAYLOAD_MANIFEST);
            this._validateRequiredManifests(Constants.TAG_MANIFEST);
            this._validateManifestEntries(Constants.PAYLOAD_MANIFEST);
            this._validateManifestEntries(Constants.TAG_MANIFEST);
            this._validateNoExtraneousPayloadFiles();
            this._validatePayloadOxum();
            this._validateTags();
        }
        this.emit('end')
    }

    /**
     * _validateSerialization checks to see whether or not the bag is
     * in a format that adheres to the profile's serialization rules.
     *
     * For example, if the profile's serialization attribute is "required"
     * and acceptSerialization is "application/tar", then this bag MUST
     * be a tar file.
     *
     * You can disable this check by setting
     * Validator.disableSerializationCheck to true. You would want to do
     * that in cases where you've built a bag and want to validate it
     * before you tar or zip it.
     *
     * @returns {boolean} entry - True if profile is valid, false if not.
     *
     */
    _validateSerialization() {
        var validFormat = true;
        if (!this.disableSerializationCheck) {
            var checkSerializationFormat = true;
            var bagIsDirectory = fs.statSync(this.pathToBag).isDirectory();
            if (this.profile.serialization == 'required') {
                if (bagIsDirectory) {
                    this.errors.push(Context.y18n.__("Profile says bag must be serialized, but it is a directory."));
                    validFormat = false;
                }
            } else if (this.profile.serialization == 'forbidden') {
                if (!bagIsDirectory) {
                    this.errors.push(Context.y18n.__("Profile says bag must not be serialized, but bag is not a directory."));
                    validFormat = false;
                    checkSerializationFormat = false;
                }
            }
            if (!bagIsDirectory &amp;&amp; checkSerializationFormat) {
                if (!this._validateSerializationFormat()) {
                    var ext = path.extname(this.pathToBag);
                    this.errors.push(Context.y18n.__("Bag has extension %s, but profile says it must be serialized as of one of the following types: %s.", ext, this.profile.acceptSerialization.join(', ')));
                    validFormat = false;
                }
            }
        } else {
            Context.logger.info(`Validator: Skipping validation of serialization format because disableSerializationCheck is true.`);
        }
        return validFormat;
    }

    /**
     * _validateSerializationFormat checks to see if the bag is in an allowed
     * serialized format. This is called only if necessary.
     *
     * @returns {boolean} entry - True if format is valid, false if not.
     *
     */
    _validateSerializationFormat() {
        var matchesValidExtension = false;
        for (var mimetype of this.profile.acceptSerialization) {
            var extensionRegex = Constants.SERIALIZATION_FORMATS[mimetype];
            if (extensionRegex !== undefined &amp;&amp; this.pathToBag.match(extensionRegex)) {
                matchesValidExtension = true;
            }
        }
        return matchesValidExtension;
    }

    /**
     * _validateProfile validates the BagItProfile that will be used to
     * validate the bag. If the profile itself is not valid, we can't proceed.
     *
     * Errors in the BagItProfile will be copied into the validator.errors
     * list.
     *
     * @returns {boolean} entry - True if profile is valid, false if not.
     *
     */
    _validateProfile() {
        if (this.profile == null) {
            this.errors.push(Context.y18n.__("Cannot validate bag because BagItProfile is missing."));
            return false;
        }
        if (!this.profile.validate()) {
            for (let err of Object.values(this.profile.errors)) {
                this.errors.push(`BagItProfile: ${err}`);
            }
            return false;
        }
        return true;
    }

    /**
     * _readEntry reads a single entry from a TarReader or FileSystemReader.
     * An entry represents one file within the bag (any type of file: payload,
     * manifest, tag manifest, or tag file). This method add's the file's metadata
     * to the Validator.files hash, computes the file's checksums, and parses the
     * file's contents if necessary.
     *
     * @param {object} entry - An entry returned by a TarReader or FileSystemReader.
     *
     */
    _readEntry(entry) {
        if (entry.fileStat.isFile()) {
            var bagItFile = this._addBagItFile(entry);
            this._readFile(bagItFile, entry.stream);
        } else if (entry.fileStat.isDirectory()) {
            var relPath = this._cleanEntryRelPath(entry.relPath);
            if (this.bagRoot == null &amp;&amp; relPath == '') {
                this.bagRoot = entry.relPath.replace(/\/$/, ''); // right relpath for untarring
            } else if (this.bagRoot == null &amp;&amp; relPath == entry.relPath.replace(/\/$/, '')) {
                this.bagRoot = relPath; // wrong relpath for untarring
            } else {
                this.topLevelDirs.push(relPath);
            }
            entry.stream.pipe(new stream.PassThrough());
        } else {
            // Skip symlinks, block devices, etc.
            entry.stream.pipe(new stream.PassThrough());
            Context.logger.info(`Validator: ${entry.relPath} as is not a regular file`);
        }
    }

    /**
     * _addBagItFile adds a BagItFile to the Validator.files hash, based on
     * the entry it receives from the reader. At this point, the newly created
     * BagItFile will have its path and stats info, but no parsed data or
     * checksums.
     *
     * @param {object} entry - An entry returned by a TarReader or FileSystemReader.
     *
     * @param {string} entry.relPath - The relative path of the file inside the bag.
     *
     * @param {FileStat|fs.Stat} entry.fileStat - An object containing stats info
     * about the file.
     *
     * @returns {BagItFile} The BagItFile created from the entry object.
     *
     */
    _addBagItFile(entry) {
        this.emit('task', new TaskDescription(entry.relPath, 'add'));
        var relPath = this._cleanEntryRelPath(entry.relPath);
        var absPath = '';
        if (!this.readingFromTar()) {
            absPath = path.join(this.pathToBag, relPath);
            if (os.platform() === 'win32' &amp;&amp; relPath.indexOf("\\") > -1) {
                relPath = relPath.replace(/\\/g, '/');
            }
        }
        var bagItFile = new BagItFile(absPath, relPath, entry.fileStat);
        this.files[relPath] = bagItFile;
        var fileType = BagItFile.getFileType(relPath);
        //Context.logger.info(`Validator added ${relPath} as ${fileType}`);
        return bagItFile;
    }

    /**
     * _cleanEntryRelPath removes trailing slashes from relPath. When the
     * validator is reading from a tar file, this also removes the leading
     * bag name from the path. Since tarred bags must untar to a directory
     * whose name matches the bag, relative paths within tar files will
     * always be prefixed with the bag name. To get a true relative path,
     * we have to change "bagname/data/file.txt" to "data/file.txt".
     *
     * @param {string} relPath - The relative path, as we got it from the
     * TarReader or FileSystemReader.
     *
     * @returns {string} A clean version of the relative path.
     *
     */
    _cleanEntryRelPath(relPath) {
        var cleanPath = relPath;
        if (this.readingFromTar()) {
            var tarFileName = path.basename(this.pathToBag, '.tar');
            var re = new RegExp("^" + tarFileName + "/");
            cleanPath = relPath.replace(re, '');
        }
        return cleanPath.replace(/\/$/, '');
    }

    /**
     * _readFile pushes the file's bits through whatever checksum algorithms
     * the {@link BagItProfile} says we're supposed to validate. It also parses
     * the contents of the file, if it happens to be a manifest, tag manifest,
     * or text-based tag file.
     *
     * Note that the read() method of TarReader and FileSystemReader will not
     * advance until we've read the entire stream (or until it closes or errors out).
     *
     * @param {BagItFile} bagItFile - A file inside the directory or tarball.
     *
     * @param {ReadStream} readStream - A stream from which we can read
     * the file's contents.
     */
    _readFile(bagItFile, readStream) {
        var validator = this;
        this.emit('task', new TaskDescription(bagItFile.relDestPath, 'checksum'));

        // Get pipes for all of the hash digests we'll need to calculate.
        // We need to calculate checksums on everything in the bag.
        var pipes = this._getCryptoHashes(bagItFile)

        // For manifests, tag manifests, and tag files, we need to parse
        // file contents as well.
        if (bagItFile.isPayloadManifest() || bagItFile.isTagManifest()) {
            var manifestParser = new ManifestParser(bagItFile);
            pipes.push(manifestParser.stream);
        } else if (bagItFile.isTagFile() &amp;&amp; bagItFile.relDestPath.endsWith(".txt")) {
            var tagFileParser = new TagFileParser(bagItFile);
            pipes.push(tagFileParser.stream);
        }

        // Push read errors up to where the user can see them.
        readStream.on('error', function(err) {
            validator.errors.push(`Read error in ${bagItFile.relDestPath}: ${err.toString()}`)
        });

        // Now we can do a single read of the file, piping it through
        // streams for checksum calculations and parsing. This is much
        // more efficient than doing a seperate read for each, especially
        // in bags that use multiple digest algorithms.
        readStream.pause();
        for (var p of pipes) {
            readStream.pipe(p);
        }
        readStream.resume();
        //Context.logger.info(`Validator is running checksums for ${bagItFile.relDestPath}`);
    }

    /**
     * _getCryptoHashes returns a list of prepared cryptographic hashes that
     * are ready to have bits streamed through them. Each hash includes a
     * pre-wired 'end' event that assigns the computed checksum to the
     * BagItFile's checksums hash. For example, a sha256 hash, once the bits
     * have been pushed through it, will set the following in it's event event:
     *
     * @example
     * bagItFile.checksums['sha256'] = "[computed hex value]";
     *
     * @param {BagItFile} bagItFile - A file inside the directory or tarball.
     * This is the file whose checksums will be computed.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     * @returns {Array&lt;crypto.Hash>}
     *
     */
    _getCryptoHashes(bagItFile) {
        let validator = this;
        let hashes = [];
        // Put together all of the algorithms we'll need for checksums,
        // filtering out empty strings and duplicates.
        let m = this.profile.manifestsRequired;
        let t = this.profile.tagManifestsRequired;
        let f = this.manifestAlgorithmsFoundInBag;
        let algorithms = new Set(m.concat(t, f).filter(alg => alg != ''));
        // The done function decreases the validator's internal counter
        // of how many digests are still begin calculated.
        let done = function() { validator._hashCompleted() };
        for (let algorithm of algorithms) {
            hashes.push(bagItFile.getCryptoHash(algorithm, done));
            validator._hashesInProgress++;
        }
        return hashes;
    }

    _hashCompleted() {
        this._hashesInProgress--;
    }

    /**
     * _validateUntarDirectory is for tarred bags only. It checks to see
     * whether the tar file extracts to a directory whose name matches
     * the bag name, minus the ".tar" extension. If it doesn't untar there,
     * this method adds an error to the validation results.
     *
     * E.g. "myBag.tar" should untar to a directory called "myBag"
     *
     * This rule only apples for BagItProfiles where tarDirMustMatchName
     * is true.
     *
     * The official BagIt 1.0 spec at
     * https://tools.ietf.org/html/draft-kunze-bagit-17#section-2 says:
     *
     * `The base directory can have any name.`
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     * @returns {boolean} - If true, it's ok to proceed with the rest
     * of the validation. If false, validation stops, because no files
     * will be in their expected places.
     *
     */
    _validateUntarDirectory() {
        var okToProceed = true;
        if (this.readingFromTar() &amp;&amp; this.profile.tarDirMustMatchName) {
            var tarFileName = path.basename(this.pathToBag, '.tar');
            if (this.bagRoot != tarFileName) {
                this.errors.push(`Bag should untar to directory '${tarFileName}', not '${this.bagRoot}'`);
                okToProceed = false;
            }
        }
        return okToProceed;
    }


    /**
     * _validateTopLevelDirs checks to see if any directories other than
     * the required "data" directory exist at the top level of the bag
     * structure. Some {@link BagItProfile}s allow for this, others do not.
     * If an illegal top-level directory appears in the bag, this method
     * will make a note of it in the Validator.errors array.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     */
    _validateTopLevelDirs() {
        //Context.logger.info(`Validator: Validating top-level directories in ${this.pathToBag}`);
        var exceptions = ['data']; // data dir is always required
        for (var f of this.profile.tagFileNames()) {
            var requiredTagDir = f.split('/', 1);
            exceptions.push(requiredTagDir);
        }
        if (!this.profile.allowMiscDirectories) {
            for (var dir of this.topLevelDirs) {
                if (!Util.listContains(exceptions, dir)) {
                    this.errors.push(`Profile prohibits top-level directory ${dir}`);
                }
            }
        }
    }

    /**
     * _validateTopLevelFiles looks for illegal files in the top-level directory
     * of the bag. Most bags require certain top-level tag files (bagit.txt,
     * bag-info.txt, etc.) and manifests (manifest-sha256.txt,
     * tagmanifest-sha256.txt, etc), but some {@link BagItProfile}s allow
     * miscellaneous files to exist in that space and others do not.
     *
     * If this method finds illegal top-level files, it will make a note of each
     * one in the Validator.errors array.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     */
    _validateTopLevelFiles() {
        //Context.logger.info(`Validator: Validating top-level files in ${this.pathToBag}`);
        if (!this.profile.allowMiscTopLevelFiles) {
            var expected = this._expectedTopLevelFiles();
            for (var name of this.topLevelFiles) {
                if (!Util.listContains(expected, name)) {
                    this.errors.push(`Profile prohibits top-level file ${name}`);
                }
            }
        }
    }

    /**
     * This returns a list of expected top-level file names, based on the
     * BagItProfile. Top-level files are those directly beneath the bag's
     * top-level folder, such as bag-info.txt and manifests.
     *
     * @returns {Array&lt;string>}
     *
     */
    _expectedTopLevelFiles() {
        var expected = this.profile.tagFileNames();
        if (this.profile.allowFetchTxt) {
            expected.push('fetch.txt');
        }
        for (var alg of this.profile.manifestsRequired) {
            expected.push(`manifest-${alg}.txt`);
        }
        for (var alg of this.profile.tagManifestsRequired) {
            expected.push(`tagmanifest-${alg}.txt`);
        }
        return expected;
    }

    /**
     * _validateRequiredManifests checks to see if the manifests required by
     * the {@link BagItProfile} are actually present in the bag. If they're not,
     * it records the error in the Validator.errors array.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     * @param {string} manifestType - The type of manifest to look for.
     * This should be either {@link Constants.PAYLOAD_MANIFEST} or
     * {Constants.TAG_MANIFEST}.
     *
     */
    _validateRequiredManifests(manifestType) {
        //Context.logger.info(`Validator: Validating ${manifestType}s`);
        var manifestList = this.profile.manifestsRequired;
        if (manifestType === Constants.TAG_MANIFEST) {
            manifestList = this.profile.tagManifestsRequired;
        }
        for (var alg of manifestList) {
            var name = `${manifestType}-${alg}.txt`
            if(this.files[name] === undefined) {
                this.errors.push(`Bag is missing required manifest ${name}`);
            }
        }
    }

    /**
     * _validateManifestEntries checks to see that the checksum entries in a
     * payload manifest or tag manifest match the actual computed digests of
     * the files in the bag. It records mismatches in the Validator.errors
     * array.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     * @param {string} manifestType - The type of manifest to look for.
     * This should be either {@link Constants.PAYLOAD_MANIFEST} or
     * {Constants.TAG_MANIFEST}.
     *
     */
    _validateManifestEntries(manifestType) {
        var manifests = this.payloadManifests();
        if (manifestType === Constants.TAG_MANIFEST) {
            manifests = this.tagManifests();
        }
        //Context.logger.info(`Validator: Validating ${manifests.length} ${manifestType}s`);
        for(var manifest of Object.values(manifests)) {
            //Context.logger.info(`Validator: Validating ${manifest.relDestPath}`);
            var basename = path.basename(manifest.relDestPath, '.txt');
            var algorithm = basename.split('-')[1];
            for (var filename of manifest.keyValueCollection.keys()) {
                var bagItFile = this.files[filename];
                if (bagItFile === undefined) {
                    this.errors.push(`File '${filename}' in ${manifest.relDestPath} is missing from bag.`);
                    continue;
                }
                var checksumInManifest = manifest.keyValueCollection.first(filename);
                var calculatedChecksum = bagItFile.checksums[algorithm];
                if (checksumInManifest != calculatedChecksum) {
                    this.errors.push(`Bad ${algorithm} digest for '${filename}': manifest says '${checksumInManifest}', file digest is '${calculatedChecksum}'.`);
                }
            }
        }
    }

    /**
     * _validateNoExtraneousPayloadFiles checks for files in the data directory
     * that are not listed in the payload manifest(s). It records offending
     * files in the Validator.errors array.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     */
    _validateNoExtraneousPayloadFiles() {
        //Context.logger.info(`Validator: Looking for extraneous payload files in ${this.pathToBag}`);
        for(var manifest of this.payloadManifests()) {
            for (var f of this.payloadFiles()) {
                if (!manifest.keyValueCollection.first(f.relDestPath)) {
                    this.errors.push(`Payload file ${f.relDestPath} not found in ${manifest.relDestPath}`);
                }
            }
        }
    }

    /**
     * _validateTags ensures that all required tag files are present, that
     * all required tags are present, and that all tags have valid values
     * if valid values were defined in the {@link BagItProfile}. This method
     * records all the problems it finds in the Validator.errors array.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     */
    _validateTags() {
        //Context.logger.info(`Validator: Validating tags in ${this.pathToBag}`);
        var requiredTags = this.profile.tagsGroupedByFile();
        for (var filename of Object.keys(requiredTags)) {
            //Context.logger.info(`Validator: Validating tags in ${filename}`);
            var tagFile = this.files[filename];
            if (tagFile === undefined) {
                this.errors.push(`Required tag file ${filename} is missing`);
                continue;
            }
            if (tagFile.keyValueCollection == null) {
                this.errors.push(`Tag file ${filename} has no data`);
                continue;
            }
            this._validateTagsInFile(filename, tagFile);
        }
    }

    /**
     * _validateTagsInFile ensures that all required tags in the specified file
     * are present, that all required tags are present, and that all tags have
     * valid values if valid values were defined in the {@link BagItProfile}.
     * This method records all the problems it finds in the Validator.errors
     * array.
     *
     * @param {string} filename - The name of the tag file. E.g. bag-info.txt.
     *
     * @param {BagItFile} tagFile - The tag file whose contents we want to
     * examine.
     *
     * @private
     *
     */
    _validateTagsInFile(filename, tagFile) {
        var requiredTags = this.profile.tagsGroupedByFile();
        for (var tagDef of requiredTags[filename]) {
            var parsedTagValues = tagFile.keyValueCollection.all(tagDef.tagName);
            if (parsedTagValues == null) {
                // Tag was not present at all.
                if (tagDef.required) {
                    this.errors.push(`Required tag ${tagDef.tagName} is missing from ${filename}`);
                }
                continue;
            }
            for (var value of parsedTagValues) {
                if (tagDef.required &amp;&amp; value == '') {
                    this.errors.push(`Value for tag '${tagDef.tagName}' in ${filename} is missing.`);
                    continue;
                }
                if (Array.isArray(tagDef.values) &amp;&amp; tagDef.values.length > 0 &amp;&amp; !Util.listContains(tagDef.values, value)) {
                    this.errors.push(`Tag '${tagDef.tagName}' in ${filename} contains illegal value '${value}'. [Allowed: ${tagDef.values.join(', ')}]`);
                }
            }
        }
    }

    /**
     * _validatePayloadOxum
     *
     * Validates the Payload-Oxum tag, if present, by comparing the number
     * of files and bytes in the bag's payload directory matches what's in
     * the tag.
     *
     * This method is private, and it internal operations are
     * subject to change without notice.
     *
     */
    _validatePayloadOxum() {
        //Context.logger.info(`Validator: Validating Payload-Oxum in ${this.pathToBag}`);
        let found = false;
        let bagInfo = this.files["bag-info.txt"];
        if (bagInfo &amp;&amp; bagInfo.keyValueCollection) {
            let oxum = bagInfo.keyValueCollection.first("Payload-Oxum");
            if (oxum) {
                found = true;
                let parts = oxum.split('.');
                let oxumBytes = parseInt(parts[0], 10);
                let oxumFiles = parseInt(parts[1], 10);
                let byteCount = 0;
                let fileCount = 0;
                for (let f of this.payloadFiles()) {
                    fileCount += 1;
                    byteCount += f.size;
                }
                if (oxumFiles != fileCount) {
                    this.errors.push(`Payload-Oxum says there should be ${oxumFiles} files in the payload, but validator found ${fileCount}.`);
                }
                if (oxumBytes != byteCount) {
                    this.errors.push(`Payload-Oxum says there should be ${oxumBytes} bytes in the payload, but validator found ${byteCount}.`);
                }
            }
        }
        if (found === false) {
            Context.logger.info(`Validator: No Payload-Oxum in ${this.pathToBag}`);
        }
    }

}

module.exports.Validator = Validator;
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
