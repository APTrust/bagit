<div id="divJobStorage">

  {{! jobTabs tabStorage = true }}

  <h2>Storage</h2>
  <p>Upload {{ bagOrFiles }} to the following storage services:</p>

  <form>

      {{> inputCheckboxGroup field = form.fields.storageServices }}

  </form>

  <div class="clearfix" style="height: 30px;"></div>

  <div class="pull-right" id="btnJobReviewDiv">
    <a class="btn btn-primary" id="btnJobReview" role="button">Next &gt;&gt;</a>
  </div>

  <div class="pull-left" id="divPrevious">
    <a class="btn btn-primary" id="btnPrevious" role="button">&lt;&lt; Previous</a>
  </div>

</div>

<script>
 $('[data-toggle="popover"]').popover();

 $("#btnJobReview").click(function() {
     var job = es.ActiveObject;
     job.setStorageServicesFromForm();
     job.save();
     var data = {};
     data['job'] = job;
     data['storageServices'] = job.storageServices;
     // Handlebars overwrites 'this' even inside of classes.
     if (job.bagItProfile != null) {
       data['bagTitle'] = job.bagItProfile.bagTitle();
       data['bagDescription'] = job.bagItProfile.bagDescription();
       data['bagInternalIdentifier'] = job.bagItProfile.bagInternalIdentifier();
     }
     $("#container").html(templates.jobReview(data));
 });

 $("#btnPrevious").click(function() {
     var job = es.ActiveObject;
     job.setStorageServicesFromForm();
     job.save();
     var data = {};
     if (job.bagItProfile != null) {
         // TODO: Refactor. This code also appears in job_packaging.html.
         var tags = job.bagItProfile.tagsGroupedByFile();
         data['tags'] = tags;
         data['cssClassFor'] = {};
         data['messageFor'] = {};
         var fileStatus = job.bagItProfile.tagFileCompletionStatus();
         for (var filename in fileStatus) {
             var allRequiredTagsHaveValues = fileStatus[filename];
             if (allRequiredTagsHaveValues) {
                 // Collapsed
                 data['cssClassFor'][filename] = 'collapse';
                 data['messageFor'][filename] = 'All required tags for this file have been filled in.';
             } else {
                 // Visible
                 data['cssClassFor'][filename] = 'panel-collapse';
                 data['messageFor'][filename] = '';
             }
         }

         $("#container").html(templates.jobTags(data));
     } else {
         data.form = job.toPackagingForm();
         data.domainName = es.AppSetting.findByName("Institution Domain").value;
         $("#container").html(templates.jobPackaging(data));
     }
});
</script>
